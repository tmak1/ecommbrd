{"ast":null,"code":"var _jsxFileName = \"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/server/client/src/components/users/pages/AllUserProducts.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport UserProductList from '../components/UserProductList.js';\nimport UserProductUpdateModalForm from '../components/UserProductUpdateModalForm.js';\nimport SkeletonHistory from '../../shared/ui/skeletons/SkeletonHistory';\nimport { listAdminProducts, deleteProduct, updateProductByAdmin } from '../../../redux/actionCreators/productActionCreators.js';\nimport { formatFileName } from '../../../helpers';\nimport PageHeading from '../../shared/ui/PageHeading.js';\nimport AlertMessage from '../../shared/ui/AlertMessage.js';\nimport DecisionDialog from '../../shared/ui/DecisionDialog.js';\nimport initializeFirebase from '../../../firebase';\nimport categories from '../../../categories.js';\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Zoom from '@material-ui/core/Zoom';\nimport Toast from '../../shared/ui/Toast';\nimport RefreshIcon from '@material-ui/icons/RefreshSharp';\nimport ListSearchBar from '../components/ListSearchBar.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  topBtns: {\n    display: 'flex',\n    width: '100%',\n    marginBottom: '10px',\n    justifyContent: 'flex-end',\n    alignItems: 'center'\n  },\n  iconBtn: {\n    padding: '0px',\n    marginRight: '50px',\n    marginBottom: '20px'\n  },\n  btn: {\n    height: '50px',\n    padding: '0 10px',\n    backgroundColor: theme.palette.primary.dark,\n    fontSize: '14px',\n    fontWeight: '700',\n    borderRadius: '0',\n    color: '#fff',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.main\n    }\n  }\n}));\n\nconst AllUserProducts = () => {\n  _s();\n\n  var _loggedInUser$user6;\n\n  const classes = useStyles();\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const [openToast, setOpenToast] = useState(false);\n  const [operation, setOperation] = useState();\n  const [modalOpen, setModalOpen] = useState(false);\n  const [productToUpdate, setProductToUpdate] = useState();\n  const [productToDelete, setProductToDelete] = useState();\n  const {\n    loading,\n    error,\n    productInfo\n  } = useSelector(state => state.adminProductList || {});\n  const {\n    loggedInUser\n  } = useSelector(state => state.userAuth);\n\n  const deleteImage = async fileName => {\n    const firebase = await initializeFirebase(loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token);\n\n    try {\n      const url = await firebase.storage().ref('/products/images').child(fileName).getDownloadURL();\n\n      if (!url) {\n        throw new Error('That image does not exist');\n      }\n\n      const fileRef = firebase.storage().refFromURL(url);\n      await (fileRef === null || fileRef === void 0 ? void 0 : fileRef.delete());\n      console.log('Deleted image');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const onSuccess = async () => {\n    var _loggedInUser$user;\n\n    if (operation === 'delete') {\n      const fileName = formatFileName(productToDelete.name);\n      await deleteImage(fileName);\n    }\n\n    setOpenToast(true);\n    dispatch(listAdminProducts(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user = loggedInUser.user) === null || _loggedInUser$user === void 0 ? void 0 : _loggedInUser$user.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token));\n\n    if (modalOpen === true) {\n      setModalOpen(false);\n    }\n  };\n\n  const handleOperation = (operation, productToHandle) => {\n    if (operation === 'delete') {\n      setProductToDelete(productToHandle);\n      setModalOpen(true);\n      setOperation('delete');\n    } else if (operation === 'update') {\n      setProductToUpdate(productToHandle);\n      setModalOpen(true);\n      setOperation('update');\n    }\n  };\n\n  const handleDeleteSubmit = () => {\n    dispatch(deleteProduct(productToDelete.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token, onSuccess));\n  };\n\n  const handleUpdateSubmit = productInfo => {\n    dispatch(updateProductByAdmin(productToUpdate.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token, productInfo, onSuccess));\n  };\n\n  const handlePageChange = (page, perPage) => {\n    var _loggedInUser$user2;\n\n    dispatch(listAdminProducts(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user2 = loggedInUser.user) === null || _loggedInUser$user2 === void 0 ? void 0 : _loggedInUser$user2.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token, '', page, perPage));\n  };\n\n  const handlePerPageChange = perPage => {\n    var _loggedInUser$user3;\n\n    dispatch(listAdminProducts(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user3 = loggedInUser.user) === null || _loggedInUser$user3 === void 0 ? void 0 : _loggedInUser$user3.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token, '', '', perPage));\n  };\n\n  useEffect(() => {\n    if (loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token) {\n      var _loggedInUser$user4;\n\n      dispatch(listAdminProducts(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user4 = loggedInUser.user) === null || _loggedInUser$user4 === void 0 ? void 0 : _loggedInUser$user4.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token));\n    }\n  }, [loggedInUser, dispatch]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(PageHeading, {\n      text: \"ALL PRODUCTS\",\n      gutterBottom: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DecisionDialog, {\n      open: modalOpen,\n      setDialogOpen: setModalOpen,\n      title: operation === 'update' ? 'Change Product Details' : 'Delete Product',\n      content: operation === 'delete' ? `Are you sure you wish to delete product ${productToDelete.name}` : '',\n      actionBtnText: operation === 'delete' ? 'DELETE' : null,\n      handleAction: operation === 'delete' ? handleDeleteSubmit : null,\n      children: operation === 'update' && productToUpdate && /*#__PURE__*/_jsxDEV(UserProductUpdateModalForm, {\n        productToUpdate: productToUpdate,\n        handleUpdate: handleUpdateSubmit,\n        categories: categories,\n        loggedInUser: loggedInUser\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Toast, {\n      openToast: openToast,\n      setOpenToast: setOpenToast,\n      severity: \"success\",\n      message: operation === 'delete' ? 'Product deleted!' : 'Product details updated!'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.topBtns,\n      children: [/*#__PURE__*/_jsxDEV(ListSearchBar, {\n        item: \"product\",\n        args: [loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.user.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          flex: 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n        TransitionComponent: Zoom,\n        title: \"Refresh\",\n        children: /*#__PURE__*/_jsxDEV(IconButton, {\n          className: classes.iconBtn,\n          color: \"primary\",\n          onClick: () => {\n            var _loggedInUser$user5;\n\n            return dispatch(listAdminProducts(loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user5 = loggedInUser.user) === null || _loggedInUser$user5 === void 0 ? void 0 : _loggedInUser$user5.id, loggedInUser === null || loggedInUser === void 0 ? void 0 : loggedInUser.token));\n          },\n          style: {\n            marginTop: '20px'\n          },\n          children: /*#__PURE__*/_jsxDEV(RefreshIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        disableElevation: true,\n        className: classes.btn,\n        onClick: () => history.push('/products/new'),\n        children: \"+ Create Product\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 7\n    }, this), loading && /*#__PURE__*/_jsxDEV(SkeletonHistory, {\n      headings: ['ID', 'NAME', 'PRICE', 'CATEGRY', 'BRAND', '']\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 9\n    }, this), error && /*#__PURE__*/_jsxDEV(AlertMessage, {\n      message: error,\n      severity: \"error\",\n      variant: \"outlined\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 9\n    }, this), !loading && (productInfo === null || productInfo === void 0 ? void 0 : productInfo.products) && /*#__PURE__*/_jsxDEV(UserProductList, {\n      productInfo: productInfo,\n      handleOperation: handleOperation,\n      loggedInUserId: loggedInUser === null || loggedInUser === void 0 ? void 0 : (_loggedInUser$user6 = loggedInUser.user) === null || _loggedInUser$user6 === void 0 ? void 0 : _loggedInUser$user6.id,\n      handlePageChange: handlePageChange,\n      handlePerPageChange: handlePerPageChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(AllUserProducts, \"kGPLfHxS8ELNs0IdHg0iyIcQZr8=\", false, function () {\n  return [useStyles, useHistory, useDispatch, useSelector, useSelector];\n});\n\n_c = AllUserProducts;\nexport default AllUserProducts;\n\nvar _c;\n\n$RefreshReg$(_c, \"AllUserProducts\");","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/server/client/src/components/users/pages/AllUserProducts.js"],"names":["React","useEffect","useState","useHistory","useDispatch","useSelector","UserProductList","UserProductUpdateModalForm","SkeletonHistory","listAdminProducts","deleteProduct","updateProductByAdmin","formatFileName","PageHeading","AlertMessage","DecisionDialog","initializeFirebase","categories","makeStyles","IconButton","Button","Tooltip","Zoom","Toast","RefreshIcon","ListSearchBar","useStyles","theme","topBtns","display","width","marginBottom","justifyContent","alignItems","iconBtn","padding","marginRight","btn","height","backgroundColor","palette","primary","dark","fontSize","fontWeight","borderRadius","color","main","AllUserProducts","classes","history","dispatch","openToast","setOpenToast","operation","setOperation","modalOpen","setModalOpen","productToUpdate","setProductToUpdate","productToDelete","setProductToDelete","loading","error","productInfo","state","adminProductList","loggedInUser","userAuth","deleteImage","fileName","firebase","token","url","storage","ref","child","getDownloadURL","Error","fileRef","refFromURL","delete","console","log","onSuccess","name","user","id","handleOperation","productToHandle","handleDeleteSubmit","handleUpdateSubmit","handlePageChange","page","perPage","handlePerPageChange","flex","marginTop","push","products"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport UserProductList from '../components/UserProductList.js';\nimport UserProductUpdateModalForm from '../components/UserProductUpdateModalForm.js';\nimport SkeletonHistory from '../../shared/ui/skeletons/SkeletonHistory';\n\nimport {\n  listAdminProducts,\n  deleteProduct,\n  updateProductByAdmin,\n} from '../../../redux/actionCreators/productActionCreators.js';\n\nimport { formatFileName } from '../../../helpers';\n\nimport PageHeading from '../../shared/ui/PageHeading.js';\nimport AlertMessage from '../../shared/ui/AlertMessage.js';\nimport DecisionDialog from '../../shared/ui/DecisionDialog.js';\n\nimport initializeFirebase from '../../../firebase';\nimport categories from '../../../categories.js';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Zoom from '@material-ui/core/Zoom';\nimport Toast from '../../shared/ui/Toast';\nimport RefreshIcon from '@material-ui/icons/RefreshSharp';\nimport ListSearchBar from '../components/ListSearchBar.js';\n\nconst useStyles = makeStyles((theme) => ({\n  topBtns: {\n    display: 'flex',\n    width: '100%',\n    marginBottom: '10px',\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n  },\n  iconBtn: {\n    padding: '0px',\n    marginRight: '50px',\n    marginBottom: '20px',\n  },\n  btn: {\n    height: '50px',\n    padding: '0 10px',\n    backgroundColor: theme.palette.primary.dark,\n    fontSize: '14px',\n    fontWeight: '700',\n    borderRadius: '0',\n    color: '#fff',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.main,\n    },\n  },\n}));\n\nconst AllUserProducts = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const [openToast, setOpenToast] = useState(false);\n  const [operation, setOperation] = useState();\n  const [modalOpen, setModalOpen] = useState(false);\n  const [productToUpdate, setProductToUpdate] = useState();\n  const [productToDelete, setProductToDelete] = useState();\n  const { loading, error, productInfo } = useSelector(\n    (state) => state.adminProductList || {}\n  );\n  const { loggedInUser } = useSelector((state) => state.userAuth);\n\n  const deleteImage = async (fileName) => {\n    const firebase = await initializeFirebase(loggedInUser?.token);\n    try {\n      const url = await firebase\n        .storage()\n        .ref('/products/images')\n        .child(fileName)\n        .getDownloadURL();\n      if (!url) {\n        throw new Error('That image does not exist');\n      }\n      const fileRef = firebase.storage().refFromURL(url);\n      await fileRef?.delete();\n      console.log('Deleted image');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  const onSuccess = async () => {\n    if (operation === 'delete') {\n      const fileName = formatFileName(productToDelete.name);\n      await deleteImage(fileName);\n    }\n    setOpenToast(true);\n    dispatch(listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token));\n    if (modalOpen === true) {\n      setModalOpen(false);\n    }\n  };\n  const handleOperation = (operation, productToHandle) => {\n    if (operation === 'delete') {\n      setProductToDelete(productToHandle);\n      setModalOpen(true);\n      setOperation('delete');\n    } else if (operation === 'update') {\n      setProductToUpdate(productToHandle);\n      setModalOpen(true);\n      setOperation('update');\n    }\n  };\n  const handleDeleteSubmit = () => {\n    dispatch(deleteProduct(productToDelete.id, loggedInUser?.token, onSuccess));\n  };\n  const handleUpdateSubmit = (productInfo) => {\n    dispatch(\n      updateProductByAdmin(\n        productToUpdate.id,\n        loggedInUser?.token,\n        productInfo,\n        onSuccess\n      )\n    );\n  };\n  const handlePageChange = (page, perPage) => {\n    dispatch(\n      listAdminProducts(\n        loggedInUser?.user?.id,\n        loggedInUser?.token,\n        '',\n        page,\n        perPage\n      )\n    );\n  };\n  const handlePerPageChange = (perPage) => {\n    dispatch(\n      listAdminProducts(\n        loggedInUser?.user?.id,\n        loggedInUser?.token,\n        '',\n        '',\n        perPage\n      )\n    );\n  };\n  useEffect(() => {\n    if (loggedInUser?.token) {\n      dispatch(listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token));\n    }\n  }, [loggedInUser, dispatch]);\n\n  return (\n    <>\n      <PageHeading text=\"ALL PRODUCTS\" gutterBottom />\n      <DecisionDialog\n        open={modalOpen}\n        setDialogOpen={setModalOpen}\n        title={\n          operation === 'update' ? 'Change Product Details' : 'Delete Product'\n        }\n        content={\n          operation === 'delete'\n            ? `Are you sure you wish to delete product ${productToDelete.name}`\n            : ''\n        }\n        actionBtnText={operation === 'delete' ? 'DELETE' : null}\n        handleAction={operation === 'delete' ? handleDeleteSubmit : null}\n      >\n        {operation === 'update' && productToUpdate && (\n          <UserProductUpdateModalForm\n            productToUpdate={productToUpdate}\n            handleUpdate={handleUpdateSubmit}\n            categories={categories}\n            loggedInUser={loggedInUser}\n          />\n        )}\n      </DecisionDialog>\n      <Toast\n        openToast={openToast}\n        setOpenToast={setOpenToast}\n        severity=\"success\"\n        message={\n          operation === 'delete'\n            ? 'Product deleted!'\n            : 'Product details updated!'\n        }\n      />\n      <div className={classes.topBtns}>\n        <ListSearchBar\n          item=\"product\"\n          args={[loggedInUser?.user.id, loggedInUser?.token]}\n        />\n        <div style={{ flex: 1 }}></div>\n        <Tooltip TransitionComponent={Zoom} title=\"Refresh\">\n          <IconButton\n            className={classes.iconBtn}\n            color=\"primary\"\n            onClick={() =>\n              dispatch(\n                listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token)\n              )\n            }\n            style={{ marginTop: '20px' }}\n          >\n            <RefreshIcon />\n          </IconButton>\n        </Tooltip>\n        <Button\n          variant=\"contained\"\n          disableElevation\n          className={classes.btn}\n          onClick={() => history.push('/products/new')}\n        >\n          + Create Product\n        </Button>\n      </div>\n      {loading && (\n        <SkeletonHistory\n          headings={['ID', 'NAME', 'PRICE', 'CATEGRY', 'BRAND', '']}\n        />\n      )}\n      {error && (\n        <AlertMessage message={error} severity=\"error\" variant=\"outlined\" />\n      )}\n      {!loading && productInfo?.products && (\n        <UserProductList\n          productInfo={productInfo}\n          handleOperation={handleOperation}\n          loggedInUserId={loggedInUser?.user?.id}\n          handlePageChange={handlePageChange}\n          handlePerPageChange={handlePerPageChange}\n        />\n      )}\n    </>\n  );\n};\n\nexport default AllUserProducts;\n"]},"metadata":{},"sourceType":"module"}