{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from'react';import{useDispatch}from'react-redux';import{Formik,Form}from'formik';import*as Yup from'yup';import FormikTextField from'../../shared/formElements/FormikTextField';import PageHeading from'../../shared/ui/PageHeading';import{createProductReview}from'../../../redux/actionCreators/reviewActionCreators';import{makeStyles}from'@material-ui/core/styles';import Paper from'@material-ui/core/Paper';import Button from'@material-ui/core/Button';import Rating from'@material-ui/lab/Rating';import Typography from'@material-ui/core/Typography';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:{maxWidth:'600px',margin:'10px 0px 70px 20px',textAlign:'left'},ratingBox:{minHeight:'40px',display:'flex',alignItems:'center',margin:0,padding:0},btn:{padding:'12px',width:'90px',backgroundColor:theme.palette.primary.dark,fontSize:'14px',fontWeight:'700',borderRadius:'0px',color:'#fff','&:hover':{backgroundColor:theme.palette.primary.main}}};});var ratingLabels={1:'Useless',2:'Poor',3:'Ok',4:'Good',5:'Excellent'};var ReviewForm=function ReviewForm(_ref){var loggedInUser=_ref.loggedInUser,product=_ref.product,review=_ref.review,refreshReviews=_ref.refreshReviews;var classes=useStyles();var dispatch=useDispatch();var _useState=useState(-1),_useState2=_slicedToArray(_useState,2),hover=_useState2[0],setHover=_useState2[1];var initialValues={rating:(review===null||review===void 0?void 0:review.rating)||0,comment:(review===null||review===void 0?void 0:review.comment)||''};var validationSchema=Yup.object({rating:Yup.number('Must be a number').required('Price required').positive('Must be positive').oneOf(_toConsumableArray(Array(5).keys()).map(function(num){return num+1;})),comment:Yup.string().notRequired()});var onSuccess=function onSuccess(){refreshReviews();};var submitHandler=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(values,actions){var _values$comment;var reviewInfo;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:reviewInfo={rating:Number(values.rating),comment:(_values$comment=values.comment)===null||_values$comment===void 0?void 0:_values$comment.trim()};dispatch(createProductReview(product.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,reviewInfo,onSuccess));actions.setSubmitting(false);case 3:case\"end\":return _context.stop();}}},_callee);}));return function submitHandler(_x,_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageHeading,{text:\"Rate or post a review\",size:\"medium\"}),/*#__PURE__*/_jsx(Paper,{className:classes.root,elevation:0,children:/*#__PURE__*/_jsx(Formik,{initialValues:initialValues,validationSchema:validationSchema,onSubmit:submitHandler,validateOnMount:true,enableReinitialize:true,children:function children(formik){return/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.ratingBox,children:[/*#__PURE__*/_jsx(Rating,{name:\"rating\",label:\"Leave a rating\",value:formik.values.rating||formik.initialValues.rating,onChange:function onChange(event){var val=Number(event.target.value);formik.setFieldValue('rating',val);},onChangeActive:function onChangeActive(event,newHover){setHover(newHover);},precision:1.0}),formik.values.rating!==null&&/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",style:{marginLeft:'10px',lineHeight:'2rem'},children:/*#__PURE__*/_jsx(\"em\",{children:ratingLabels[hover!==-1?hover:formik.values.rating]})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.formControl,children:/*#__PURE__*/_jsx(FormikTextField,{fieldName:\"comment\",type:\"text\",label:\"Leave a comment\",as:\"textarea\",variant:\"outlined\",maxLength:1000,multiline:true,rows:5,placeholder:\"Write a review...\",values:formik.values.comment||formik.initialValues.comment})}),/*#__PURE__*/_jsx(Button,{type:\"submit\",disabled:!formik.isValid||formik.isSubmitting||formik.values.rating===formik.initialValues.rating&&formik.values.comment===formik.initialValues.comment,variant:\"contained\",disableElevation:true,className:classes.btn,children:\"POST\"})]});}})})]});};export default ReviewForm;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/products/components/ReviewForm.js"],"names":["React","useState","useDispatch","Formik","Form","Yup","FormikTextField","PageHeading","createProductReview","makeStyles","Paper","Button","Rating","Typography","useStyles","theme","root","maxWidth","margin","textAlign","ratingBox","minHeight","display","alignItems","padding","btn","width","backgroundColor","palette","primary","dark","fontSize","fontWeight","borderRadius","color","main","ratingLabels","ReviewForm","loggedInUser","product","review","refreshReviews","classes","dispatch","hover","setHover","initialValues","rating","comment","validationSchema","object","number","required","positive","oneOf","Array","keys","map","num","string","notRequired","onSuccess","submitHandler","values","actions","reviewInfo","Number","trim","id","token","setSubmitting","formik","event","val","target","value","setFieldValue","newHover","marginLeft","lineHeight","formControl","isValid","isSubmitting"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Formik, Form } from 'formik';\nimport * as Yup from 'yup';\n\nimport FormikTextField from '../../shared/formElements/FormikTextField';\nimport PageHeading from '../../shared/ui/PageHeading';\n\nimport { createProductReview } from '../../../redux/actionCreators/reviewActionCreators';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Paper from '@material-ui/core/Paper';\nimport Button from '@material-ui/core/Button';\nimport Rating from '@material-ui/lab/Rating';\nimport Typography from '@material-ui/core/Typography';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    maxWidth: '600px',\n    margin: '10px 0px 70px 20px',\n    textAlign: 'left',\n  },\n  ratingBox: {\n    minHeight: '40px',\n    display: 'flex',\n    alignItems: 'center',\n    margin: 0,\n    padding: 0,\n  },\n  btn: {\n    padding: '12px',\n    width: '90px',\n    backgroundColor: theme.palette.primary.dark,\n    fontSize: '14px',\n    fontWeight: '700',\n    borderRadius: '0px',\n    color: '#fff',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.main,\n    },\n  },\n}));\nconst ratingLabels = {\n  1: 'Useless',\n  2: 'Poor',\n  3: 'Ok',\n  4: 'Good',\n  5: 'Excellent',\n};\nconst ReviewForm = ({ loggedInUser, product, review, refreshReviews }) => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const [hover, setHover] = useState(-1);\n  const initialValues = {\n    rating: review?.rating || 0,\n    comment: review?.comment || '',\n  };\n  const validationSchema = Yup.object({\n    rating: Yup.number('Must be a number')\n      .required('Price required')\n      .positive('Must be positive')\n      .oneOf([...Array(5).keys()].map((num) => num + 1)),\n    comment: Yup.string().notRequired(),\n  });\n  const onSuccess = () => {\n    refreshReviews();\n  };\n  const submitHandler = async (values, actions) => {\n    const reviewInfo = {\n      rating: Number(values.rating),\n      comment: values.comment?.trim(),\n    };\n\n    dispatch(\n      createProductReview(\n        product.id,\n        loggedInUser?.token,\n        reviewInfo,\n        onSuccess\n      )\n    );\n    actions.setSubmitting(false);\n  };\n\n  return (\n    <>\n      <PageHeading text=\"Rate or post a review\" size=\"medium\" />\n      <Paper className={classes.root} elevation={0}>\n        <Formik\n          initialValues={initialValues}\n          validationSchema={validationSchema}\n          onSubmit={submitHandler}\n          validateOnMount\n          enableReinitialize\n        >\n          {(formik) => (\n            <Form>\n              <div className={classes.ratingBox}>\n                <Rating\n                  name=\"rating\"\n                  label=\"Leave a rating\"\n                  value={formik.values.rating || formik.initialValues.rating}\n                  onChange={(event) => {\n                    const val = Number(event.target.value);\n                    formik.setFieldValue('rating', val);\n                  }}\n                  onChangeActive={(event, newHover) => {\n                    setHover(newHover);\n                  }}\n                  precision={1.0}\n                />\n                {formik.values.rating !== null && (\n                  <Typography\n                    variant=\"caption\"\n                    color=\"textSecondary\"\n                    style={{ marginLeft: '10px', lineHeight: '2rem' }}\n                  >\n                    <em>\n                      {\n                        ratingLabels[\n                          hover !== -1 ? hover : formik.values.rating\n                        ]\n                      }\n                    </em>\n                  </Typography>\n                )}\n              </div>\n              <div className={classes.formControl}>\n                <FormikTextField\n                  fieldName=\"comment\"\n                  type=\"text\"\n                  label=\"Leave a comment\"\n                  as=\"textarea\"\n                  variant=\"outlined\"\n                  maxLength={1000}\n                  multiline\n                  rows={5}\n                  placeholder=\"Write a review...\"\n                  values={formik.values.comment || formik.initialValues.comment}\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                disabled={\n                  !formik.isValid ||\n                  formik.isSubmitting ||\n                  (formik.values.rating === formik.initialValues.rating &&\n                    formik.values.comment === formik.initialValues.comment)\n                }\n                variant=\"contained\"\n                disableElevation\n                className={classes.btn}\n              >\n                POST\n              </Button>\n            </Form>\n          )}\n        </Formik>\n      </Paper>\n    </>\n  );\n};\n\nexport default ReviewForm;\n"]},"metadata":{},"sourceType":"module"}