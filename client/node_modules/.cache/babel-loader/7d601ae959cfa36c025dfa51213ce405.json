{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{useHistory}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import UserProductList from'../components/UserProductList.js';import UserProductUpdateModalForm from'../components/UserProductUpdateModalForm.js';import SkeletonHistory from'../../shared/ui/skeletons/SkeletonHistory';import{listAdminProducts,deleteProduct,updateProductByAdmin}from'../../../redux/actionCreators/productActionCreators.js';import{formatFileName}from'../../../helpers';import PageHeading from'../../shared/ui/PageHeading.js';import AlertMessage from'../../shared/ui/AlertMessage.js';import DecisionDialog from'../../shared/ui/DecisionDialog.js';import initializeFirebase from'../../../firebase';import categories from'../../../categories.js';import{makeStyles}from'@material-ui/core/styles';import IconButton from'@material-ui/core/IconButton';import Button from'@material-ui/core/Button';import Tooltip from'@material-ui/core/Tooltip';import Zoom from'@material-ui/core/Zoom';import Toast from'../../shared/ui/Toast';import RefreshIcon from'@material-ui/icons/RefreshSharp';import ListSearchBar from'../components/ListSearchBar.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{topBtns:{display:'flex',width:'100%',marginBottom:'10px',justifyContent:'flex-end',alignItems:'center'},iconBtn:{padding:'0px',marginRight:'50px',marginBottom:'20px'},btn:{height:'50px',padding:'0 10px',backgroundColor:theme.palette.primary.dark,fontSize:'14px',fontWeight:'700',borderRadius:'0',color:'#fff','&:hover':{backgroundColor:theme.palette.primary.main}}};});var AllUserProducts=function AllUserProducts(){var _loggedInUser$user6;var classes=useStyles();var history=useHistory();var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),openToast=_useState2[0],setOpenToast=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),operation=_useState4[0],setOperation=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),modalOpen=_useState6[0],setModalOpen=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),productToUpdate=_useState8[0],setProductToUpdate=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),productToDelete=_useState10[0],setProductToDelete=_useState10[1];var _useSelector=useSelector(function(state){return state.adminProductList||{};}),loading=_useSelector.loading,error=_useSelector.error,productInfo=_useSelector.productInfo;var _useSelector2=useSelector(function(state){return state.userAuth;}),loggedInUser=_useSelector2.loggedInUser;var deleteImage=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(fileName){var firebase,url,fileRef;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return initializeFirebase(loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token);case 2:firebase=_context.sent;_context.prev=3;_context.next=6;return firebase.storage().ref('/products/images').child(fileName).getDownloadURL();case 6:url=_context.sent;if(url){_context.next=9;break;}throw new Error('That image does not exist');case 9:fileRef=firebase.storage().refFromURL(url);_context.next=12;return fileRef===null||fileRef===void 0?void 0:fileRef.delete();case 12:console.log('Deleted image');_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](3);console.log(_context.t0);case 18:case\"end\":return _context.stop();}}},_callee,null,[[3,15]]);}));return function deleteImage(_x){return _ref.apply(this,arguments);};}();var onSuccess=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _loggedInUser$user;var fileName;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(operation==='delete')){_context2.next=4;break;}fileName=formatFileName(productToDelete.name);_context2.next=4;return deleteImage(fileName);case 4:setOpenToast(true);dispatch(listAdminProducts(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user=loggedInUser.user)===null||_loggedInUser$user===void 0?void 0:_loggedInUser$user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));if(modalOpen===true){setModalOpen(false);}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function onSuccess(){return _ref2.apply(this,arguments);};}();var handleOperation=function handleOperation(operation,productToHandle){if(operation==='delete'){setProductToDelete(productToHandle);setModalOpen(true);setOperation('delete');}else if(operation==='update'){setProductToUpdate(productToHandle);setModalOpen(true);setOperation('update');}};var handleDeleteSubmit=function handleDeleteSubmit(){dispatch(deleteProduct(productToDelete.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,onSuccess));};var handleUpdateSubmit=function handleUpdateSubmit(productInfo){dispatch(updateProductByAdmin(productToUpdate.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,productInfo,onSuccess));};var handlePageChange=function handlePageChange(page,perPage){var _loggedInUser$user2;dispatch(listAdminProducts(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user2=loggedInUser.user)===null||_loggedInUser$user2===void 0?void 0:_loggedInUser$user2.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,'',page,perPage));};var handlePerPageChange=function handlePerPageChange(perPage){var _loggedInUser$user3;dispatch(listAdminProducts(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user3=loggedInUser.user)===null||_loggedInUser$user3===void 0?void 0:_loggedInUser$user3.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,'','',perPage));};useEffect(function(){if(loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token){var _loggedInUser$user4;dispatch(listAdminProducts(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user4=loggedInUser.user)===null||_loggedInUser$user4===void 0?void 0:_loggedInUser$user4.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));}},[loggedInUser,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(PageHeading,{text:\"ALL PRODUCTS\",gutterBottom:true}),/*#__PURE__*/_jsx(DecisionDialog,{open:modalOpen,setDialogOpen:setModalOpen,title:operation==='update'?'Change Product Details':'Delete Product',content:operation==='delete'?\"Are you sure you wish to delete product \".concat(productToDelete.name):'',actionBtnText:operation==='delete'?'DELETE':null,handleAction:operation==='delete'?handleDeleteSubmit:null,children:operation==='update'&&productToUpdate&&/*#__PURE__*/_jsx(UserProductUpdateModalForm,{productToUpdate:productToUpdate,handleUpdate:handleUpdateSubmit,categories:categories,loggedInUser:loggedInUser})}),/*#__PURE__*/_jsx(Toast,{openToast:openToast,setOpenToast:setOpenToast,severity:\"success\",message:operation==='delete'?'Product deleted!':'Product details updated!'}),/*#__PURE__*/_jsxs(\"div\",{className:classes.topBtns,children:[/*#__PURE__*/_jsx(ListSearchBar,{item:\"product\",args:[loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token]}),/*#__PURE__*/_jsx(\"div\",{style:{flex:1}}),/*#__PURE__*/_jsx(Tooltip,{TransitionComponent:Zoom,title:\"Refresh\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.iconBtn,color:\"primary\",onClick:function onClick(){var _loggedInUser$user5;return dispatch(listAdminProducts(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user5=loggedInUser.user)===null||_loggedInUser$user5===void 0?void 0:_loggedInUser$user5.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));},style:{marginTop:'20px'},children:/*#__PURE__*/_jsx(RefreshIcon,{})})}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",disableElevation:true,className:classes.btn,onClick:function onClick(){return history.push('/products/new');},children:\"+ Create Product\"})]}),loading&&/*#__PURE__*/_jsx(SkeletonHistory,{headings:['ID','NAME','PRICE','CATEGRY','BRAND','']}),error&&/*#__PURE__*/_jsx(AlertMessage,{message:error,severity:\"error\",variant:\"outlined\"}),!loading&&(productInfo===null||productInfo===void 0?void 0:productInfo.products)&&/*#__PURE__*/_jsx(UserProductList,{productInfo:productInfo,handleOperation:handleOperation,loggedInUserId:loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user6=loggedInUser.user)===null||_loggedInUser$user6===void 0?void 0:_loggedInUser$user6.id,handlePageChange:handlePageChange,handlePerPageChange:handlePerPageChange})]});};export default AllUserProducts;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/users/pages/AllUserProducts.js"],"names":["React","useEffect","useState","useHistory","useDispatch","useSelector","UserProductList","UserProductUpdateModalForm","SkeletonHistory","listAdminProducts","deleteProduct","updateProductByAdmin","formatFileName","PageHeading","AlertMessage","DecisionDialog","initializeFirebase","categories","makeStyles","IconButton","Button","Tooltip","Zoom","Toast","RefreshIcon","ListSearchBar","useStyles","theme","topBtns","display","width","marginBottom","justifyContent","alignItems","iconBtn","padding","marginRight","btn","height","backgroundColor","palette","primary","dark","fontSize","fontWeight","borderRadius","color","main","AllUserProducts","classes","history","dispatch","openToast","setOpenToast","operation","setOperation","modalOpen","setModalOpen","productToUpdate","setProductToUpdate","productToDelete","setProductToDelete","state","adminProductList","loading","error","productInfo","userAuth","loggedInUser","deleteImage","fileName","token","firebase","storage","ref","child","getDownloadURL","url","Error","fileRef","refFromURL","delete","console","log","onSuccess","name","user","id","handleOperation","productToHandle","handleDeleteSubmit","handleUpdateSubmit","handlePageChange","page","perPage","handlePerPageChange","flex","marginTop","push","products"],"mappings":"qfAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,UAAT,KAA2B,kBAA3B,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CAEA,MAAOC,CAAAA,eAAP,KAA4B,kCAA5B,CACA,MAAOC,CAAAA,0BAAP,KAAuC,6CAAvC,CACA,MAAOC,CAAAA,eAAP,KAA4B,2CAA5B,CAEA,OACEC,iBADF,CAEEC,aAFF,CAGEC,oBAHF,KAIO,wDAJP,CAMA,OAASC,cAAT,KAA+B,kBAA/B,CAEA,MAAOC,CAAAA,WAAP,KAAwB,gCAAxB,CACA,MAAOC,CAAAA,YAAP,KAAyB,iCAAzB,CACA,MAAOC,CAAAA,cAAP,KAA2B,mCAA3B,CAEA,MAAOC,CAAAA,kBAAP,KAA+B,mBAA/B,CACA,MAAOC,CAAAA,UAAP,KAAuB,wBAAvB,CAEA,OAASC,UAAT,KAA2B,0BAA3B,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,OAAP,KAAoB,2BAApB,CACA,MAAOC,CAAAA,IAAP,KAAiB,wBAAjB,CACA,MAAOC,CAAAA,KAAP,KAAkB,uBAAlB,CACA,MAAOC,CAAAA,WAAP,KAAwB,iCAAxB,CACA,MAAOC,CAAAA,aAAP,KAA0B,gCAA1B,C,6IAEA,GAAMC,CAAAA,SAAS,CAAGR,UAAU,CAAC,SAACS,KAAD,QAAY,CACvCC,OAAO,CAAE,CACPC,OAAO,CAAE,MADF,CAEPC,KAAK,CAAE,MAFA,CAGPC,YAAY,CAAE,MAHP,CAIPC,cAAc,CAAE,UAJT,CAKPC,UAAU,CAAE,QALL,CAD8B,CAQvCC,OAAO,CAAE,CACPC,OAAO,CAAE,KADF,CAEPC,WAAW,CAAE,MAFN,CAGPL,YAAY,CAAE,MAHP,CAR8B,CAavCM,GAAG,CAAE,CACHC,MAAM,CAAE,MADL,CAEHH,OAAO,CAAE,QAFN,CAGHI,eAAe,CAAEZ,KAAK,CAACa,OAAN,CAAcC,OAAd,CAAsBC,IAHpC,CAIHC,QAAQ,CAAE,MAJP,CAKHC,UAAU,CAAE,KALT,CAMHC,YAAY,CAAE,GANX,CAOHC,KAAK,CAAE,MAPJ,CAQH,UAAW,CACTP,eAAe,CAAEZ,KAAK,CAACa,OAAN,CAAcC,OAAd,CAAsBM,IAD9B,CARR,CAbkC,CAAZ,EAAD,CAA5B,CA2BA,GAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,EAAM,yBAC5B,GAAMC,CAAAA,OAAO,CAAGvB,SAAS,EAAzB,CACA,GAAMwB,CAAAA,OAAO,CAAG/C,UAAU,EAA1B,CACA,GAAMgD,CAAAA,QAAQ,CAAG/C,WAAW,EAA5B,CACA,cAAkCF,QAAQ,CAAC,KAAD,CAA1C,wCAAOkD,SAAP,eAAkBC,YAAlB,eACA,eAAkCnD,QAAQ,EAA1C,yCAAOoD,SAAP,eAAkBC,YAAlB,eACA,eAAkCrD,QAAQ,CAAC,KAAD,CAA1C,yCAAOsD,SAAP,eAAkBC,YAAlB,eACA,eAA8CvD,QAAQ,EAAtD,yCAAOwD,eAAP,eAAwBC,kBAAxB,eACA,eAA8CzD,QAAQ,EAAtD,0CAAO0D,eAAP,gBAAwBC,kBAAxB,gBACA,iBAAwCxD,WAAW,CACjD,SAACyD,KAAD,QAAWA,CAAAA,KAAK,CAACC,gBAAN,EAA0B,EAArC,EADiD,CAAnD,CAAQC,OAAR,cAAQA,OAAR,CAAiBC,KAAjB,cAAiBA,KAAjB,CAAwBC,WAAxB,cAAwBA,WAAxB,CAGA,kBAAyB7D,WAAW,CAAC,SAACyD,KAAD,QAAWA,CAAAA,KAAK,CAACK,QAAjB,EAAD,CAApC,CAAQC,YAAR,eAAQA,YAAR,CAEA,GAAMC,CAAAA,WAAW,0FAAG,iBAAOC,QAAP,iKACKtD,CAAAA,kBAAkB,CAACoD,YAAD,SAACA,YAAD,iBAACA,YAAY,CAAEG,KAAf,CADvB,QACZC,QADY,qDAGEA,CAAAA,QAAQ,CACvBC,OADe,GAEfC,GAFe,CAEX,kBAFW,EAGfC,KAHe,CAGTL,QAHS,EAIfM,cAJe,EAHF,QAGVC,GAHU,kBAQXA,GARW,8BASR,IAAIC,CAAAA,KAAJ,CAAU,2BAAV,CATQ,QAWVC,OAXU,CAWAP,QAAQ,CAACC,OAAT,GAAmBO,UAAnB,CAA8BH,GAA9B,CAXA,wBAYVE,CAAAA,OAZU,SAYVA,OAZU,iBAYVA,OAAO,CAAEE,MAAT,EAZU,SAahBC,OAAO,CAACC,GAAR,CAAY,eAAZ,EAbgB,iFAehBD,OAAO,CAACC,GAAR,cAfgB,qEAAH,kBAAXd,CAAAA,WAAW,4CAAjB,CAkBA,GAAMe,CAAAA,SAAS,2FAAG,iLACZ9B,SAAS,GAAK,QADF,2BAERgB,QAFQ,CAEG1D,cAAc,CAACgD,eAAe,CAACyB,IAAjB,CAFjB,wBAGRhB,CAAAA,WAAW,CAACC,QAAD,CAHH,QAKhBjB,YAAY,CAAC,IAAD,CAAZ,CACAF,QAAQ,CAAC1C,iBAAiB,CAAC2D,YAAD,SAACA,YAAD,qCAACA,YAAY,CAAEkB,IAAf,6CAAC,mBAAoBC,EAArB,CAAyBnB,YAAzB,SAAyBA,YAAzB,iBAAyBA,YAAY,CAAEG,KAAvC,CAAlB,CAAR,CACA,GAAIf,SAAS,GAAK,IAAlB,CAAwB,CACtBC,YAAY,CAAC,KAAD,CAAZ,CACD,CATe,wDAAH,kBAAT2B,CAAAA,SAAS,2CAAf,CAWA,GAAMI,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAClC,SAAD,CAAYmC,eAAZ,CAAgC,CACtD,GAAInC,SAAS,GAAK,QAAlB,CAA4B,CAC1BO,kBAAkB,CAAC4B,eAAD,CAAlB,CACAhC,YAAY,CAAC,IAAD,CAAZ,CACAF,YAAY,CAAC,QAAD,CAAZ,CACD,CAJD,IAIO,IAAID,SAAS,GAAK,QAAlB,CAA4B,CACjCK,kBAAkB,CAAC8B,eAAD,CAAlB,CACAhC,YAAY,CAAC,IAAD,CAAZ,CACAF,YAAY,CAAC,QAAD,CAAZ,CACD,CACF,CAVD,CAWA,GAAMmC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CAC/BvC,QAAQ,CAACzC,aAAa,CAACkD,eAAe,CAAC2B,EAAjB,CAAqBnB,YAArB,SAAqBA,YAArB,iBAAqBA,YAAY,CAAEG,KAAnC,CAA0Ca,SAA1C,CAAd,CAAR,CACD,CAFD,CAGA,GAAMO,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACzB,WAAD,CAAiB,CAC1Cf,QAAQ,CACNxC,oBAAoB,CAClB+C,eAAe,CAAC6B,EADE,CAElBnB,YAFkB,SAElBA,YAFkB,iBAElBA,YAAY,CAAEG,KAFI,CAGlBL,WAHkB,CAIlBkB,SAJkB,CADd,CAAR,CAQD,CATD,CAUA,GAAMQ,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,IAAD,CAAOC,OAAP,CAAmB,yBAC1C3C,QAAQ,CACN1C,iBAAiB,CACf2D,YADe,SACfA,YADe,sCACfA,YAAY,CAAEkB,IADC,8CACf,oBAAoBC,EADL,CAEfnB,YAFe,SAEfA,YAFe,iBAEfA,YAAY,CAAEG,KAFC,CAGf,EAHe,CAIfsB,IAJe,CAKfC,OALe,CADX,CAAR,CASD,CAVD,CAWA,GAAMC,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACD,OAAD,CAAa,yBACvC3C,QAAQ,CACN1C,iBAAiB,CACf2D,YADe,SACfA,YADe,sCACfA,YAAY,CAAEkB,IADC,8CACf,oBAAoBC,EADL,CAEfnB,YAFe,SAEfA,YAFe,iBAEfA,YAAY,CAAEG,KAFC,CAGf,EAHe,CAIf,EAJe,CAKfuB,OALe,CADX,CAAR,CASD,CAVD,CAWA7F,SAAS,CAAC,UAAM,CACd,GAAImE,YAAJ,SAAIA,YAAJ,iBAAIA,YAAY,CAAEG,KAAlB,CAAyB,yBACvBpB,QAAQ,CAAC1C,iBAAiB,CAAC2D,YAAD,SAACA,YAAD,sCAACA,YAAY,CAAEkB,IAAf,8CAAC,oBAAoBC,EAArB,CAAyBnB,YAAzB,SAAyBA,YAAzB,iBAAyBA,YAAY,CAAEG,KAAvC,CAAlB,CAAR,CACD,CACF,CAJQ,CAIN,CAACH,YAAD,CAAejB,QAAf,CAJM,CAAT,CAMA,mBACE,wCACE,KAAC,WAAD,EAAa,IAAI,CAAC,cAAlB,CAAiC,YAAY,KAA7C,EADF,cAEE,KAAC,cAAD,EACE,IAAI,CAAEK,SADR,CAEE,aAAa,CAAEC,YAFjB,CAGE,KAAK,CACHH,SAAS,GAAK,QAAd,CAAyB,wBAAzB,CAAoD,gBAJxD,CAME,OAAO,CACLA,SAAS,GAAK,QAAd,mDAC+CM,eAAe,CAACyB,IAD/D,EAEI,EATR,CAWE,aAAa,CAAE/B,SAAS,GAAK,QAAd,CAAyB,QAAzB,CAAoC,IAXrD,CAYE,YAAY,CAAEA,SAAS,GAAK,QAAd,CAAyBoC,kBAAzB,CAA8C,IAZ9D,UAcGpC,SAAS,GAAK,QAAd,EAA0BI,eAA1B,eACC,KAAC,0BAAD,EACE,eAAe,CAAEA,eADnB,CAEE,YAAY,CAAEiC,kBAFhB,CAGE,UAAU,CAAE1E,UAHd,CAIE,YAAY,CAAEmD,YAJhB,EAfJ,EAFF,cAyBE,KAAC,KAAD,EACE,SAAS,CAAEhB,SADb,CAEE,YAAY,CAAEC,YAFhB,CAGE,QAAQ,CAAC,SAHX,CAIE,OAAO,CACLC,SAAS,GAAK,QAAd,CACI,kBADJ,CAEI,0BAPR,EAzBF,cAmCE,aAAK,SAAS,CAAEL,OAAO,CAACrB,OAAxB,wBACE,KAAC,aAAD,EACE,IAAI,CAAC,SADP,CAEE,IAAI,CAAE,CAACwC,YAAD,SAACA,YAAD,iBAACA,YAAY,CAAEkB,IAAd,CAAmBC,EAApB,CAAwBnB,YAAxB,SAAwBA,YAAxB,iBAAwBA,YAAY,CAAEG,KAAtC,CAFR,EADF,cAKE,YAAK,KAAK,CAAE,CAAEyB,IAAI,CAAE,CAAR,CAAZ,EALF,cAME,KAAC,OAAD,EAAS,mBAAmB,CAAE1E,IAA9B,CAAoC,KAAK,CAAC,SAA1C,uBACE,KAAC,UAAD,EACE,SAAS,CAAE2B,OAAO,CAACf,OADrB,CAEE,KAAK,CAAC,SAFR,CAGE,OAAO,CAAE,iDACPiB,CAAAA,QAAQ,CACN1C,iBAAiB,CAAC2D,YAAD,SAACA,YAAD,sCAACA,YAAY,CAAEkB,IAAf,8CAAC,oBAAoBC,EAArB,CAAyBnB,YAAzB,SAAyBA,YAAzB,iBAAyBA,YAAY,CAAEG,KAAvC,CADX,CADD,EAHX,CAQE,KAAK,CAAE,CAAE0B,SAAS,CAAE,MAAb,CART,uBAUE,KAAC,WAAD,IAVF,EADF,EANF,cAoBE,KAAC,MAAD,EACE,OAAO,CAAC,WADV,CAEE,gBAAgB,KAFlB,CAGE,SAAS,CAAEhD,OAAO,CAACZ,GAHrB,CAIE,OAAO,CAAE,yBAAMa,CAAAA,OAAO,CAACgD,IAAR,CAAa,eAAb,CAAN,EAJX,8BApBF,GAnCF,CAgEGlC,OAAO,eACN,KAAC,eAAD,EACE,QAAQ,CAAE,CAAC,IAAD,CAAO,MAAP,CAAe,OAAf,CAAwB,SAAxB,CAAmC,OAAnC,CAA4C,EAA5C,CADZ,EAjEJ,CAqEGC,KAAK,eACJ,KAAC,YAAD,EAAc,OAAO,CAAEA,KAAvB,CAA8B,QAAQ,CAAC,OAAvC,CAA+C,OAAO,CAAC,UAAvD,EAtEJ,CAwEG,CAACD,OAAD,GAAYE,WAAZ,SAAYA,WAAZ,iBAAYA,WAAW,CAAEiC,QAAzB,gBACC,KAAC,eAAD,EACE,WAAW,CAAEjC,WADf,CAEE,eAAe,CAAEsB,eAFnB,CAGE,cAAc,CAAEpB,YAAF,SAAEA,YAAF,sCAAEA,YAAY,CAAEkB,IAAhB,8CAAE,oBAAoBC,EAHtC,CAIE,gBAAgB,CAAEK,gBAJpB,CAKE,mBAAmB,CAAEG,mBALvB,EAzEJ,GADF,CAoFD,CAnLD,CAqLA,cAAe/C,CAAAA,eAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport UserProductList from '../components/UserProductList.js';\nimport UserProductUpdateModalForm from '../components/UserProductUpdateModalForm.js';\nimport SkeletonHistory from '../../shared/ui/skeletons/SkeletonHistory';\n\nimport {\n  listAdminProducts,\n  deleteProduct,\n  updateProductByAdmin,\n} from '../../../redux/actionCreators/productActionCreators.js';\n\nimport { formatFileName } from '../../../helpers';\n\nimport PageHeading from '../../shared/ui/PageHeading.js';\nimport AlertMessage from '../../shared/ui/AlertMessage.js';\nimport DecisionDialog from '../../shared/ui/DecisionDialog.js';\n\nimport initializeFirebase from '../../../firebase';\nimport categories from '../../../categories.js';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport IconButton from '@material-ui/core/IconButton';\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Zoom from '@material-ui/core/Zoom';\nimport Toast from '../../shared/ui/Toast';\nimport RefreshIcon from '@material-ui/icons/RefreshSharp';\nimport ListSearchBar from '../components/ListSearchBar.js';\n\nconst useStyles = makeStyles((theme) => ({\n  topBtns: {\n    display: 'flex',\n    width: '100%',\n    marginBottom: '10px',\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n  },\n  iconBtn: {\n    padding: '0px',\n    marginRight: '50px',\n    marginBottom: '20px',\n  },\n  btn: {\n    height: '50px',\n    padding: '0 10px',\n    backgroundColor: theme.palette.primary.dark,\n    fontSize: '14px',\n    fontWeight: '700',\n    borderRadius: '0',\n    color: '#fff',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.main,\n    },\n  },\n}));\n\nconst AllUserProducts = () => {\n  const classes = useStyles();\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const [openToast, setOpenToast] = useState(false);\n  const [operation, setOperation] = useState();\n  const [modalOpen, setModalOpen] = useState(false);\n  const [productToUpdate, setProductToUpdate] = useState();\n  const [productToDelete, setProductToDelete] = useState();\n  const { loading, error, productInfo } = useSelector(\n    (state) => state.adminProductList || {}\n  );\n  const { loggedInUser } = useSelector((state) => state.userAuth);\n\n  const deleteImage = async (fileName) => {\n    const firebase = await initializeFirebase(loggedInUser?.token);\n    try {\n      const url = await firebase\n        .storage()\n        .ref('/products/images')\n        .child(fileName)\n        .getDownloadURL();\n      if (!url) {\n        throw new Error('That image does not exist');\n      }\n      const fileRef = firebase.storage().refFromURL(url);\n      await fileRef?.delete();\n      console.log('Deleted image');\n    } catch (error) {\n      console.log(error);\n    }\n  };\n  const onSuccess = async () => {\n    if (operation === 'delete') {\n      const fileName = formatFileName(productToDelete.name);\n      await deleteImage(fileName);\n    }\n    setOpenToast(true);\n    dispatch(listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token));\n    if (modalOpen === true) {\n      setModalOpen(false);\n    }\n  };\n  const handleOperation = (operation, productToHandle) => {\n    if (operation === 'delete') {\n      setProductToDelete(productToHandle);\n      setModalOpen(true);\n      setOperation('delete');\n    } else if (operation === 'update') {\n      setProductToUpdate(productToHandle);\n      setModalOpen(true);\n      setOperation('update');\n    }\n  };\n  const handleDeleteSubmit = () => {\n    dispatch(deleteProduct(productToDelete.id, loggedInUser?.token, onSuccess));\n  };\n  const handleUpdateSubmit = (productInfo) => {\n    dispatch(\n      updateProductByAdmin(\n        productToUpdate.id,\n        loggedInUser?.token,\n        productInfo,\n        onSuccess\n      )\n    );\n  };\n  const handlePageChange = (page, perPage) => {\n    dispatch(\n      listAdminProducts(\n        loggedInUser?.user?.id,\n        loggedInUser?.token,\n        '',\n        page,\n        perPage\n      )\n    );\n  };\n  const handlePerPageChange = (perPage) => {\n    dispatch(\n      listAdminProducts(\n        loggedInUser?.user?.id,\n        loggedInUser?.token,\n        '',\n        '',\n        perPage\n      )\n    );\n  };\n  useEffect(() => {\n    if (loggedInUser?.token) {\n      dispatch(listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token));\n    }\n  }, [loggedInUser, dispatch]);\n\n  return (\n    <>\n      <PageHeading text=\"ALL PRODUCTS\" gutterBottom />\n      <DecisionDialog\n        open={modalOpen}\n        setDialogOpen={setModalOpen}\n        title={\n          operation === 'update' ? 'Change Product Details' : 'Delete Product'\n        }\n        content={\n          operation === 'delete'\n            ? `Are you sure you wish to delete product ${productToDelete.name}`\n            : ''\n        }\n        actionBtnText={operation === 'delete' ? 'DELETE' : null}\n        handleAction={operation === 'delete' ? handleDeleteSubmit : null}\n      >\n        {operation === 'update' && productToUpdate && (\n          <UserProductUpdateModalForm\n            productToUpdate={productToUpdate}\n            handleUpdate={handleUpdateSubmit}\n            categories={categories}\n            loggedInUser={loggedInUser}\n          />\n        )}\n      </DecisionDialog>\n      <Toast\n        openToast={openToast}\n        setOpenToast={setOpenToast}\n        severity=\"success\"\n        message={\n          operation === 'delete'\n            ? 'Product deleted!'\n            : 'Product details updated!'\n        }\n      />\n      <div className={classes.topBtns}>\n        <ListSearchBar\n          item=\"product\"\n          args={[loggedInUser?.user.id, loggedInUser?.token]}\n        />\n        <div style={{ flex: 1 }}></div>\n        <Tooltip TransitionComponent={Zoom} title=\"Refresh\">\n          <IconButton\n            className={classes.iconBtn}\n            color=\"primary\"\n            onClick={() =>\n              dispatch(\n                listAdminProducts(loggedInUser?.user?.id, loggedInUser?.token)\n              )\n            }\n            style={{ marginTop: '20px' }}\n          >\n            <RefreshIcon />\n          </IconButton>\n        </Tooltip>\n        <Button\n          variant=\"contained\"\n          disableElevation\n          className={classes.btn}\n          onClick={() => history.push('/products/new')}\n        >\n          + Create Product\n        </Button>\n      </div>\n      {loading && (\n        <SkeletonHistory\n          headings={['ID', 'NAME', 'PRICE', 'CATEGRY', 'BRAND', '']}\n        />\n      )}\n      {error && (\n        <AlertMessage message={error} severity=\"error\" variant=\"outlined\" />\n      )}\n      {!loading && productInfo?.products && (\n        <UserProductList\n          productInfo={productInfo}\n          handleOperation={handleOperation}\n          loggedInUserId={loggedInUser?.user?.id}\n          handlePageChange={handlePageChange}\n          handlePerPageChange={handlePerPageChange}\n        />\n      )}\n    </>\n  );\n};\n\nexport default AllUserProducts;\n"]},"metadata":{},"sourceType":"module"}