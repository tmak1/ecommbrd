{"ast":null,"code":"import _toConsumableArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import React,{useEffect,useState}from'react';import{useDispatch,useSelector}from'react-redux';import ShippingForm from'../components/ShippingForm';import LoadingLinear from'../../shared/ui/LoadingLinear';import AlertMessage from'../../shared/ui/AlertMessage';import Toast from'../../shared/ui/Toast';import CheckoutAccordian from'../../shared/ui/CheckoutAccordian';import{capitalize}from'../../../helpers';import{getShippingAddresses,removeShippingAddress}from'../../../redux/actionCreators/shippingActionCreators';import{makeStyles}from'@material-ui/core/styles';import Radio from'@material-ui/core/Radio';import Typography from'@material-ui/core/Typography';import RadioGroup from'@material-ui/core/RadioGroup';import FormControl from'@material-ui/core/FormControl';import FormLabel from'@material-ui/core/FormLabel';import IconButton from'@material-ui/core/IconButton';import Tooltip from'@material-ui/core/Tooltip';import Zoom from'@material-ui/core/Zoom';import RefreshIcon from'@material-ui/icons/RefreshSharp';import AddNewIcon from'@material-ui/icons/Add';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:_defineProperty({width:'50%',margin:theme.spacing(2,'auto'),marginBottom:theme.spacing(6),padding:0},theme.breakpoints.down('xs'),{width:'100%'}),formLabel:_defineProperty({width:'100%',marginBottom:theme.spacing(2)},theme.breakpoints.down('xs'),{margin:theme.spacing(2,'auto')}),addNewBtn:{display:'block','&:hover':{borderRadius:'3px'}}};});var dummyItemId='newAddToAddressAccordian';var Shipping=function Shipping(_ref){var validateStep=_ref.validateStep;var classes=useStyles();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),disableAddNew=_useState2[0],setDisableAddNew=_useState2[1];var _useState3=useState({openToast:false,operation:null}),_useState4=_slicedToArray(_useState3,2),toastObj=_useState4[0],setToastObj=_useState4[1];var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.userAuth;}),_useSelector$loggedIn=_useSelector.loggedInUser,user=_useSelector$loggedIn.user,token=_useSelector$loggedIn.token;var _useSelector2=useSelector(function(state){return state.shipping;}),loading=_useSelector2.loading,error=_useSelector2.error,shippingAddresses=_useSelector2.shippingAddresses;var _useSelector3=useSelector(function(state){return state.checkout;}),shippingError=_useSelector3.shippingError,selectedshipping=_useSelector3.selectedshipping;var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),loadedShippingAddresses=_useState6[0],setLoadedShippingAddresses=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),selectedAddress=_useState8[0],setSelectedAddress=_useState8[1];var discardNewAddress=function discardNewAddress(shippingId){setLoadedShippingAddresses(loadedShippingAddresses.filter(function(address){return address.id!==shippingId;}));setDisableAddNew(false);};var handleOpenToast=function handleOpenToast(open){setToastObj(function(prevState){return _objectSpread(_objectSpread({},prevState),{},{openToast:open});});};var onSuccess=function onSuccess(operation){if(operation==='removed'){setSelectedAddress(null);}setToastObj({openToast:true,operation:operation});};var handleRemoveAddress=function handleRemoveAddress(shippingId){dispatch(removeShippingAddress(user.id,token,shippingId,onSuccess));};useEffect(function(){if(selectedshipping){setSelectedAddress(JSON.stringify(selectedshipping));}},[selectedshipping]);useEffect(function(){if(token&&(user===null||user===void 0?void 0:user.id)){dispatch(getShippingAddresses(user.id,token,onSuccess));}},[user,token,dispatch]);useEffect(function(){setLoadedShippingAddresses(shippingAddresses);setDisableAddNew(false);},[shippingAddresses]);useEffect(function(){if(selectedAddress&&JSON.parse(selectedAddress)){validateStep(JSON.parse(selectedAddress));}else{validateStep(selectedAddress);}},[selectedAddress,validateStep,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Toast,{openToast:toastObj.openToast,setOpenToast:handleOpenToast,severity:\"success\",message:\"Address \".concat(toastObj.operation)}),/*#__PURE__*/_jsxs(FormControl,{component:\"fieldset\",className:classes.root,children:[/*#__PURE__*/_jsxs(FormLabel,{component:\"legend\",className:classes.formLabel,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",component:\"span\",children:\"Choose the shipping address\"}),/*#__PURE__*/_jsx(Tooltip,{TransitionComponent:Zoom,title:\"Reload\",children:/*#__PURE__*/_jsx(IconButton,{disabled:!token,color:\"primary\",onClick:function onClick(){setDisableAddNew(false);dispatch(getShippingAddresses(user.id,token));},children:/*#__PURE__*/_jsx(RefreshIcon,{})})}),/*#__PURE__*/_jsxs(IconButton,{edge:\"end\",color:\"primary\",className:classes.addNewBtn,disabled:!token||disableAddNew,disableRipple:true,onClick:function onClick(){if(!loadedShippingAddresses.find(function(address){return address.id===dummyItemId;})){setLoadedShippingAddresses([{id:dummyItemId,street:'',suburb:'',postcode:'',city:'',country:''}].concat(_toConsumableArray(loadedShippingAddresses)));setDisableAddNew(true);}},children:[/*#__PURE__*/_jsx(AddNewIcon,{style:{marginRight:'10px'}}),/*#__PURE__*/_jsx(Typography,{variant:\"button\",component:\"span\",children:/*#__PURE__*/_jsx(\"strong\",{children:\"Add a new address\"})})]})]}),loading&&/*#__PURE__*/_jsx(LoadingLinear,{}),error&&/*#__PURE__*/_jsx(AlertMessage,{message:error,severity:\"error\"}),/*#__PURE__*/_jsx(RadioGroup,{name:\"shipping\",value:selectedAddress,className:classes.others,onChange:function onChange(event){return setSelectedAddress(event.target.value);},children:(loadedShippingAddresses===null||loadedShippingAddresses===void 0?void 0:loadedShippingAddresses.length)>0?loadedShippingAddresses.map(function(address){var _address;address=capitalize(address);return/*#__PURE__*/_jsx(CheckoutAccordian,{item:address,control:/*#__PURE__*/_jsx(Radio,{checked:((_address=address)===null||_address===void 0?void 0:_address.id)===(selectedshipping===null||selectedshipping===void 0?void 0:selectedshipping.id),className:classes.radio,disabled:address.id===dummyItemId}),error:shippingError!==undefined&&shippingError!==null?shippingError:'',label:[address.street,address.suburb,address.postcode,address.city,address.country].reduce(function(acc,curr){return curr?acc+', '+curr:acc+' ';}),discardNew:discardNewAddress,handleRemoveItem:handleRemoveAddress,dummyItemId:dummyItemId,children:/*#__PURE__*/_jsx(ShippingForm,{address:address,user:user,token:token,onSuccess:onSuccess,shippingError:shippingError,setDisableAddNew:setDisableAddNew,dummyItemId:dummyItemId})},address.id);}):loadedShippingAddresses&&/*#__PURE__*/_jsx(AlertMessage,{message:\"No shipping addresses saved\",severity:\"info\"})})]})]});};export default Shipping;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/checkout/pages/Shipping.js"],"names":["React","useEffect","useState","useDispatch","useSelector","ShippingForm","LoadingLinear","AlertMessage","Toast","CheckoutAccordian","capitalize","getShippingAddresses","removeShippingAddress","makeStyles","Radio","Typography","RadioGroup","FormControl","FormLabel","IconButton","Tooltip","Zoom","RefreshIcon","AddNewIcon","useStyles","theme","root","width","margin","spacing","marginBottom","padding","breakpoints","down","formLabel","addNewBtn","display","borderRadius","dummyItemId","Shipping","validateStep","classes","disableAddNew","setDisableAddNew","openToast","operation","toastObj","setToastObj","dispatch","state","userAuth","loggedInUser","user","token","shipping","loading","error","shippingAddresses","checkout","shippingError","selectedshipping","loadedShippingAddresses","setLoadedShippingAddresses","selectedAddress","setSelectedAddress","discardNewAddress","shippingId","filter","address","id","handleOpenToast","open","prevState","onSuccess","handleRemoveAddress","JSON","stringify","parse","find","street","suburb","postcode","city","country","marginRight","others","event","target","value","length","map","radio","undefined","reduce","acc","curr"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport ShippingForm from '../components/ShippingForm';\nimport LoadingLinear from '../../shared/ui/LoadingLinear';\nimport AlertMessage from '../../shared/ui/AlertMessage';\nimport Toast from '../../shared/ui/Toast';\nimport CheckoutAccordian from '../../shared/ui/CheckoutAccordian';\nimport { capitalize } from '../../../helpers';\n\nimport {\n  getShippingAddresses,\n  removeShippingAddress,\n} from '../../../redux/actionCreators/shippingActionCreators';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Radio from '@material-ui/core/Radio';\nimport Typography from '@material-ui/core/Typography';\nimport RadioGroup from '@material-ui/core/RadioGroup';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Zoom from '@material-ui/core/Zoom';\n\nimport RefreshIcon from '@material-ui/icons/RefreshSharp';\nimport AddNewIcon from '@material-ui/icons/Add';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    width: '50%',\n    margin: theme.spacing(2, 'auto'),\n    marginBottom: theme.spacing(6),\n    padding: 0,\n    [theme.breakpoints.down('xs')]: {\n      width: '100%',\n    },\n  },\n  formLabel: {\n    width: '100%',\n    marginBottom: theme.spacing(2),\n    [theme.breakpoints.down('xs')]: {\n      margin: theme.spacing(2, 'auto'),\n    },\n  },\n  addNewBtn: {\n    display: 'block',\n    '&:hover': {\n      borderRadius: '3px',\n    },\n  },\n}));\n\nconst dummyItemId = 'newAddToAddressAccordian';\n\nconst Shipping = ({ validateStep }) => {\n  const classes = useStyles();\n  const [disableAddNew, setDisableAddNew] = useState(false);\n  const [toastObj, setToastObj] = useState({\n    openToast: false,\n    operation: null,\n  });\n\n  const dispatch = useDispatch();\n  const {\n    loggedInUser: { user, token },\n  } = useSelector((state) => state.userAuth);\n  const { loading, error, shippingAddresses } = useSelector(\n    (state) => state.shipping\n  );\n  const { shippingError, selectedshipping } = useSelector(\n    (state) => state.checkout\n  );\n  const [loadedShippingAddresses, setLoadedShippingAddresses] = useState([]);\n  const [selectedAddress, setSelectedAddress] = useState(null);\n  const discardNewAddress = (shippingId) => {\n    setLoadedShippingAddresses(\n      loadedShippingAddresses.filter((address) => address.id !== shippingId)\n    );\n    setDisableAddNew(false);\n  };\n  const handleOpenToast = (open) => {\n    setToastObj((prevState) => ({\n      ...prevState,\n      openToast: open,\n    }));\n  };\n  const onSuccess = (operation) => {\n    if (operation === 'removed') {\n      setSelectedAddress(null);\n    }\n    setToastObj({ openToast: true, operation });\n  };\n  const handleRemoveAddress = (shippingId) => {\n    dispatch(removeShippingAddress(user.id, token, shippingId, onSuccess));\n  };\n\n  useEffect(() => {\n    if (selectedshipping) {\n      setSelectedAddress(JSON.stringify(selectedshipping));\n    }\n  }, [selectedshipping]);\n\n  useEffect(() => {\n    if (token && user?.id) {\n      dispatch(getShippingAddresses(user.id, token, onSuccess));\n    }\n  }, [user, token, dispatch]);\n\n  useEffect(() => {\n    setLoadedShippingAddresses(shippingAddresses);\n    setDisableAddNew(false);\n  }, [shippingAddresses]);\n\n  useEffect(() => {\n    if (selectedAddress && JSON.parse(selectedAddress)) {\n      validateStep(JSON.parse(selectedAddress));\n    } else {\n      validateStep(selectedAddress);\n    }\n  }, [selectedAddress, validateStep, dispatch]);\n\n  return (\n    <>\n      <Toast\n        openToast={toastObj.openToast}\n        setOpenToast={handleOpenToast}\n        severity=\"success\"\n        message={`Address ${toastObj.operation}`}\n      />\n      <FormControl component=\"fieldset\" className={classes.root}>\n        <FormLabel component=\"legend\" className={classes.formLabel}>\n          <Typography variant=\"h6\" component=\"span\">\n            Choose the shipping address\n          </Typography>\n          <Tooltip TransitionComponent={Zoom} title=\"Reload\">\n            <IconButton\n              disabled={!token}\n              color=\"primary\"\n              onClick={() => {\n                setDisableAddNew(false);\n                dispatch(getShippingAddresses(user.id, token));\n              }}\n            >\n              <RefreshIcon />\n            </IconButton>\n          </Tooltip>\n          <IconButton\n            edge=\"end\"\n            color=\"primary\"\n            className={classes.addNewBtn}\n            disabled={!token || disableAddNew}\n            disableRipple\n            onClick={() => {\n              if (\n                !loadedShippingAddresses.find(\n                  (address) => address.id === dummyItemId\n                )\n              ) {\n                setLoadedShippingAddresses([\n                  {\n                    id: dummyItemId,\n                    street: '',\n                    suburb: '',\n                    postcode: '',\n                    city: '',\n                    country: '',\n                  },\n                  ...loadedShippingAddresses,\n                ]);\n                setDisableAddNew(true);\n              }\n            }}\n          >\n            <AddNewIcon style={{ marginRight: '10px' }} />\n            <Typography variant=\"button\" component=\"span\">\n              <strong>Add a new address</strong>\n            </Typography>\n          </IconButton>\n        </FormLabel>\n        {loading && <LoadingLinear />}\n        {error && <AlertMessage message={error} severity=\"error\" />}\n        <RadioGroup\n          name=\"shipping\"\n          value={selectedAddress}\n          className={classes.others}\n          onChange={(event) => setSelectedAddress(event.target.value)}\n        >\n          {loadedShippingAddresses?.length > 0\n            ? loadedShippingAddresses.map((address) => {\n                address = capitalize(address);\n                return (\n                  <CheckoutAccordian\n                    key={address.id}\n                    item={address}\n                    control={\n                      <Radio\n                        checked={address?.id === selectedshipping?.id}\n                        className={classes.radio}\n                        disabled={address.id === dummyItemId}\n                      />\n                    }\n                    error={\n                      shippingError !== undefined && shippingError !== null\n                        ? shippingError\n                        : ''\n                    }\n                    label={[\n                      address.street,\n                      address.suburb,\n                      address.postcode,\n                      address.city,\n                      address.country,\n                    ].reduce((acc, curr) =>\n                      curr ? acc + ', ' + curr : acc + ' '\n                    )}\n                    discardNew={discardNewAddress}\n                    handleRemoveItem={handleRemoveAddress}\n                    dummyItemId={dummyItemId}\n                  >\n                    <ShippingForm\n                      address={address}\n                      user={user}\n                      token={token}\n                      onSuccess={onSuccess}\n                      shippingError={shippingError}\n                      setDisableAddNew={setDisableAddNew}\n                      dummyItemId={dummyItemId}\n                    />\n                  </CheckoutAccordian>\n                );\n              })\n            : loadedShippingAddresses && (\n                <AlertMessage\n                  message=\"No shipping addresses saved\"\n                  severity=\"info\"\n                />\n              )}\n        </RadioGroup>\n      </FormControl>\n    </>\n  );\n};\n\nexport default Shipping;\n"]},"metadata":{},"sourceType":"module"}