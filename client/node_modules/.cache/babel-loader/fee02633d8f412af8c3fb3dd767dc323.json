{"ast":null,"code":"import React,{useEffect}from'react';import{useHistory,useParams}from'react-router-dom';import{useDispatch,useSelector}from'react-redux';import ListSearchBar from'../components/ListSearchBar';import{dateFormatter}from'../../../helpers';import{getOrderListByUser,updateOrderIsDelivered}from'../../../redux/actionCreators/orderActionCreators';import PageHeading from'../../shared/ui/PageHeading';import TablePaginationComp from'../../shared/ui/TablePaginationComp';import AlertMessage from'../../shared/ui/AlertMessage';import SwitchComp from'../../shared/ui/SwitchComp';import SkeletonHistory from'../../shared/ui/skeletons/SkeletonHistory';import{makeStyles,withStyles}from'@material-ui/core/styles';import Button from'@material-ui/core/Button';import TableContainer from'@material-ui/core/TableContainer';import Table from'@material-ui/core/Table';import TableHead from'@material-ui/core/TableHead';import TableBody from'@material-ui/core/TableBody';import TableRow from'@material-ui/core/TableRow';import TableCell from'@material-ui/core/TableCell';import IconButton from'@material-ui/core/IconButton';import Tooltip from'@material-ui/core/Tooltip';import Zoom from'@material-ui/core/Zoom';import RefreshIcon from'@material-ui/icons/RefreshSharp';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{topBtns:{display:'flex',width:'100%',marginBottom:'10px',justifyContent:'space-between',alignItems:'center'}};});var StyledTableCell=withStyles(function(theme){return{head:{backgroundColor:theme.palette.action.white,color:theme.palette.common.black,border:'1px solid rgba(0,0,0,0.08)'},body:{fontSize:theme.spacing(2),border:'1px solid rgba(0,0,0,0.08)'}};})(TableCell);var StyledTableRow=withStyles(function(theme){return{root:{'&:nth-of-type(odd)':{backgroundColor:theme.palette.action.hover}}};})(TableRow);var UserOrders=function UserOrders(){var _history$location,_orderInfo$orders;var classes=useStyles();var dispatch=useDispatch();var userIdFromUrl=useParams().uid;var history=useHistory();var fromAdminPage=((_history$location=history.location)===null||_history$location===void 0?void 0:_history$location.pathname.indexOf('/orders/users/'))===-1?false:true;var _useSelector=useSelector(function(state){return state.orderListByUser;}),loading=_useSelector.loading,error=_useSelector.error,orderInfo=_useSelector.orderInfo;var _useSelector2=useSelector(function(state){return state.userAuth;}),loading2=_useSelector2.loading,error2=_useSelector2.error,loggedInUser=_useSelector2.loggedInUser;var changeIsDelivered=function changeIsDelivered(orderId,delivered){if(loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token){var updateInfo={isDelivered:delivered,deliveredAt:delivered?new Date().toISOString():null};dispatch(updateOrderIsDelivered(orderId,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,updateInfo));}};var handlePageChange=function handlePageChange(page,perPage){dispatch(getOrderListByUser(fromAdminPage?userIdFromUrl:loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,'',page,perPage));};var handlePerPageChange=function handlePerPageChange(perPage){dispatch(getOrderListByUser(fromAdminPage?userIdFromUrl:loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,'','',perPage));};useEffect(function(){if(loggedInUser){dispatch(getOrderListByUser(fromAdminPage?userIdFromUrl:loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));}},[loggedInUser,fromAdminPage,userIdFromUrl,dispatch]);return/*#__PURE__*/_jsxs(_Fragment,{children:[fromAdminPage&&/*#__PURE__*/_jsx(PageHeading,{size:\"medium\",text:\"ALL USER ORDERS\",paragraph:true}),/*#__PURE__*/_jsxs(\"div\",{className:classes.topBtns,children:[/*#__PURE__*/_jsx(ListSearchBar,{item:\"user order\",args:[fromAdminPage?userIdFromUrl:loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token]}),/*#__PURE__*/_jsx(Tooltip,{TransitionComponent:Zoom,title:\"Refresh\",children:/*#__PURE__*/_jsx(IconButton,{className:classes.iconBtn,color:\"primary\",onClick:function onClick(){return dispatch(getOrderListByUser(fromAdminPage?userIdFromUrl:loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));},style:{marginTop:'20px'},children:/*#__PURE__*/_jsx(RefreshIcon,{})})})]}),(loading||loading2)&&/*#__PURE__*/_jsx(SkeletonHistory,{headings:['ORDER ID','TOTAL','PAID','DELIVERED','']}),(error||error2)&&/*#__PURE__*/_jsx(AlertMessage,{message:error||error2,severity:\"error\",variant:\"outlined\"}),!loading&&!loading2&&((orderInfo===null||orderInfo===void 0?void 0:orderInfo.orders)===null||(orderInfo===null||orderInfo===void 0?void 0:orderInfo.orders)===undefined?null:(orderInfo===null||orderInfo===void 0?void 0:orderInfo.orders.length)<=0)?/*#__PURE__*/_jsx(AlertMessage,{message:\"NO ORDER HISTORY\",severity:\"info\",variant:\"outlined\"}):!loading&&!loading2&&/*#__PURE__*/_jsx(TableContainer,{style:{marginTop:'70px'},children:/*#__PURE__*/_jsxs(Table,{style:{border:'1px solid rgba(0,0,0,0.08)'},children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(StyledTableCell,{children:\"ORDER ID\"}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Total\"}),/*#__PURE__*/_jsx(StyledTableCell,{children:\"Paid\"}),/*#__PURE__*/_jsx(StyledTableCell,{style:{textAlign:'center'},children:\"Delivered\"}),/*#__PURE__*/_jsx(StyledTableCell,{})]})}),/*#__PURE__*/_jsx(TableBody,{children:orderInfo===null||orderInfo===void 0?void 0:(_orderInfo$orders=orderInfo.orders)===null||_orderInfo$orders===void 0?void 0:_orderInfo$orders.map(function(_ref){var id=_ref.id,subTotal=_ref.subTotal,paidAt=_ref.paidAt,isDelivered=_ref.isDelivered,deliveredAt=_ref.deliveredAt;paidAt=dateFormatter(paidAt);deliveredAt=isDelivered?dateFormatter(deliveredAt):null;return/*#__PURE__*/_jsxs(StyledTableRow,{children:[/*#__PURE__*/_jsx(StyledTableCell,{children:id}),/*#__PURE__*/_jsx(StyledTableCell,{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"$\",subTotal.toFixed(2)]})}),/*#__PURE__*/_jsx(StyledTableCell,{children:paidAt}),/*#__PURE__*/_jsx(StyledTableCell,{style:{textAlign:'center'},children:/*#__PURE__*/_jsx(SwitchComp,{label:['Delivered','Not delivered'],labelColor:['green','red'],value:isDelivered,info:id,handleChange:changeIsDelivered})}),/*#__PURE__*/_jsx(StyledTableCell,{style:{textAlign:'center'},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",size:\"medium\",disableElevation:true,onClick:function onClick(){return history.push(\"/orders/\".concat(id));},children:\"DETAILS\"})})]},id);})}),orderInfo&&/*#__PURE__*/_jsx(TablePaginationComp,{colSpan:6,itemInfo:orderInfo,handlePageChange:handlePageChange,handlePerPageChange:handlePerPageChange})]})})]});};export default UserOrders;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/users/components/UserOrders.js"],"names":["React","useEffect","useHistory","useParams","useDispatch","useSelector","ListSearchBar","dateFormatter","getOrderListByUser","updateOrderIsDelivered","PageHeading","TablePaginationComp","AlertMessage","SwitchComp","SkeletonHistory","makeStyles","withStyles","Button","TableContainer","Table","TableHead","TableBody","TableRow","TableCell","IconButton","Tooltip","Zoom","RefreshIcon","useStyles","theme","topBtns","display","width","marginBottom","justifyContent","alignItems","StyledTableCell","head","backgroundColor","palette","action","white","color","common","black","border","body","fontSize","spacing","StyledTableRow","root","hover","UserOrders","classes","dispatch","userIdFromUrl","uid","history","fromAdminPage","location","pathname","indexOf","state","orderListByUser","loading","error","orderInfo","userAuth","loading2","error2","loggedInUser","changeIsDelivered","orderId","delivered","token","updateInfo","isDelivered","deliveredAt","Date","toISOString","handlePageChange","page","perPage","user","id","handlePerPageChange","iconBtn","marginTop","orders","undefined","length","textAlign","map","subTotal","paidAt","toFixed","push"],"mappings":"AAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,UAAT,CAAqBC,SAArB,KAAsC,kBAAtC,CACA,OAASC,WAAT,CAAsBC,WAAtB,KAAyC,aAAzC,CAEA,MAAOC,CAAAA,aAAP,KAA0B,6BAA1B,CAEA,OAASC,aAAT,KAA8B,kBAA9B,CAEA,OACEC,kBADF,CAEEC,sBAFF,KAGO,mDAHP,CAKA,MAAOC,CAAAA,WAAP,KAAwB,6BAAxB,CACA,MAAOC,CAAAA,mBAAP,KAAgC,qCAAhC,CACA,MAAOC,CAAAA,YAAP,KAAyB,8BAAzB,CACA,MAAOC,CAAAA,UAAP,KAAuB,4BAAvB,CACA,MAAOC,CAAAA,eAAP,KAA4B,2CAA5B,CAEA,OAASC,UAAT,CAAqBC,UAArB,KAAuC,0BAAvC,CACA,MAAOC,CAAAA,MAAP,KAAmB,0BAAnB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kCAA3B,CACA,MAAOC,CAAAA,KAAP,KAAkB,yBAAlB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,QAAP,KAAqB,4BAArB,CACA,MAAOC,CAAAA,SAAP,KAAsB,6BAAtB,CACA,MAAOC,CAAAA,UAAP,KAAuB,8BAAvB,CACA,MAAOC,CAAAA,OAAP,KAAoB,2BAApB,CACA,MAAOC,CAAAA,IAAP,KAAiB,wBAAjB,CAEA,MAAOC,CAAAA,WAAP,KAAwB,iCAAxB,C,6IAEA,GAAMC,CAAAA,SAAS,CAAGb,UAAU,CAAC,SAACc,KAAD,QAAY,CACvCC,OAAO,CAAE,CACPC,OAAO,CAAE,MADF,CAEPC,KAAK,CAAE,MAFA,CAGPC,YAAY,CAAE,MAHP,CAIPC,cAAc,CAAE,eAJT,CAKPC,UAAU,CAAE,QALL,CAD8B,CAAZ,EAAD,CAA5B,CAUA,GAAMC,CAAAA,eAAe,CAAGpB,UAAU,CAAC,SAACa,KAAD,QAAY,CAC7CQ,IAAI,CAAE,CACJC,eAAe,CAAET,KAAK,CAACU,OAAN,CAAcC,MAAd,CAAqBC,KADlC,CAEJC,KAAK,CAAEb,KAAK,CAACU,OAAN,CAAcI,MAAd,CAAqBC,KAFxB,CAGJC,MAAM,CAAE,4BAHJ,CADuC,CAM7CC,IAAI,CAAE,CACJC,QAAQ,CAAElB,KAAK,CAACmB,OAAN,CAAc,CAAd,CADN,CAEJH,MAAM,CAAE,4BAFJ,CANuC,CAAZ,EAAD,CAAV,CAUpBtB,SAVoB,CAAxB,CAYA,GAAM0B,CAAAA,cAAc,CAAGjC,UAAU,CAAC,SAACa,KAAD,QAAY,CAC5CqB,IAAI,CAAE,CACJ,qBAAsB,CACpBZ,eAAe,CAAET,KAAK,CAACU,OAAN,CAAcC,MAAd,CAAqBW,KADlB,CADlB,CADsC,CAAZ,EAAD,CAAV,CAMnB7B,QANmB,CAAvB,CAQA,GAAM8B,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,yCACvB,GAAMC,CAAAA,OAAO,CAAGzB,SAAS,EAAzB,CACA,GAAM0B,CAAAA,QAAQ,CAAGlD,WAAW,EAA5B,CACA,GAAMmD,CAAAA,aAAa,CAAGpD,SAAS,GAAGqD,GAAlC,CACA,GAAMC,CAAAA,OAAO,CAAGvD,UAAU,EAA1B,CACA,GAAMwD,CAAAA,aAAa,CACjB,oBAAAD,OAAO,CAACE,QAAR,8DAAkBC,QAAlB,CAA2BC,OAA3B,CAAmC,gBAAnC,KAAyD,CAAC,CAA1D,CAA8D,KAA9D,CAAsE,IADxE,CAGA,iBAAsCxD,WAAW,CAC/C,SAACyD,KAAD,QAAWA,CAAAA,KAAK,CAACC,eAAjB,EAD+C,CAAjD,CAAQC,OAAR,cAAQA,OAAR,CAAiBC,KAAjB,cAAiBA,KAAjB,CAAwBC,SAAxB,cAAwBA,SAAxB,CAGA,kBAII7D,WAAW,CAAC,SAACyD,KAAD,QAAWA,CAAAA,KAAK,CAACK,QAAjB,EAAD,CAJf,CACWC,QADX,eACEJ,OADF,CAESK,MAFT,eAEEJ,KAFF,CAGEK,YAHF,eAGEA,YAHF,CAMA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,OAAD,CAAUC,SAAV,CAAwB,CAChD,GAAIH,YAAJ,SAAIA,YAAJ,iBAAIA,YAAY,CAAEI,KAAlB,CAAyB,CACvB,GAAMC,CAAAA,UAAU,CAAG,CACjBC,WAAW,CAAEH,SADI,CAEjBI,WAAW,CAAEJ,SAAS,CAAG,GAAIK,CAAAA,IAAJ,GAAWC,WAAX,EAAH,CAA8B,IAFnC,CAAnB,CAIAzB,QAAQ,CACN7C,sBAAsB,CAAC+D,OAAD,CAAUF,YAAV,SAAUA,YAAV,iBAAUA,YAAY,CAAEI,KAAxB,CAA+BC,UAA/B,CADhB,CAAR,CAGD,CACF,CAVD,CAWA,GAAMK,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,IAAD,CAAOC,OAAP,CAAmB,CAC1C5B,QAAQ,CACN9C,kBAAkB,CAChBkD,aAAa,CAAGH,aAAH,CAAmBe,YAAnB,SAAmBA,YAAnB,iBAAmBA,YAAY,CAAEa,IAAd,CAAmBC,EADnC,CAEhBd,YAFgB,SAEhBA,YAFgB,iBAEhBA,YAAY,CAAEI,KAFE,CAGhB,EAHgB,CAIhBO,IAJgB,CAKhBC,OALgB,CADZ,CAAR,CASD,CAVD,CAWA,GAAMG,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACH,OAAD,CAAa,CACvC5B,QAAQ,CACN9C,kBAAkB,CAChBkD,aAAa,CAAGH,aAAH,CAAmBe,YAAnB,SAAmBA,YAAnB,iBAAmBA,YAAY,CAAEa,IAAd,CAAmBC,EADnC,CAEhBd,YAFgB,SAEhBA,YAFgB,iBAEhBA,YAAY,CAAEI,KAFE,CAGhB,EAHgB,CAIhB,EAJgB,CAKhBQ,OALgB,CADZ,CAAR,CASD,CAVD,CAWAjF,SAAS,CAAC,UAAM,CACd,GAAIqE,YAAJ,CAAkB,CAChBhB,QAAQ,CACN9C,kBAAkB,CAChBkD,aAAa,CAAGH,aAAH,CAAmBe,YAAnB,SAAmBA,YAAnB,iBAAmBA,YAAY,CAAEa,IAAd,CAAmBC,EADnC,CAEhBd,YAFgB,SAEhBA,YAFgB,iBAEhBA,YAAY,CAAEI,KAFE,CADZ,CAAR,CAMD,CACF,CATQ,CASN,CAACJ,YAAD,CAAeZ,aAAf,CAA8BH,aAA9B,CAA6CD,QAA7C,CATM,CAAT,CAWA,mBACE,2BACGI,aAAa,eACZ,KAAC,WAAD,EAAa,IAAI,CAAC,QAAlB,CAA2B,IAAI,CAAC,iBAAhC,CAAkD,SAAS,KAA3D,EAFJ,cAIE,aAAK,SAAS,CAAEL,OAAO,CAACvB,OAAxB,wBACE,KAAC,aAAD,EACE,IAAI,CAAC,YADP,CAEE,IAAI,CAAE,CACJ4B,aAAa,CAAGH,aAAH,CAAmBe,YAAnB,SAAmBA,YAAnB,iBAAmBA,YAAY,CAAEa,IAAd,CAAmBC,EAD/C,CAEJd,YAFI,SAEJA,YAFI,iBAEJA,YAAY,CAAEI,KAFV,CAFR,EADF,cAQE,KAAC,OAAD,EAAS,mBAAmB,CAAEhD,IAA9B,CAAoC,KAAK,CAAC,SAA1C,uBACE,KAAC,UAAD,EACE,SAAS,CAAE2B,OAAO,CAACiC,OADrB,CAEE,KAAK,CAAC,SAFR,CAGE,OAAO,CAAE,yBACPhC,CAAAA,QAAQ,CACN9C,kBAAkB,CAChBkD,aAAa,CAAGH,aAAH,CAAmBe,YAAnB,SAAmBA,YAAnB,iBAAmBA,YAAY,CAAEa,IAAd,CAAmBC,EADnC,CAEhBd,YAFgB,SAEhBA,YAFgB,iBAEhBA,YAAY,CAAEI,KAFE,CADZ,CADD,EAHX,CAWE,KAAK,CAAE,CAAEa,SAAS,CAAE,MAAb,CAXT,uBAaE,KAAC,WAAD,IAbF,EADF,EARF,GAJF,CA8BG,CAACvB,OAAO,EAAII,QAAZ,gBACC,KAAC,eAAD,EACE,QAAQ,CAAE,CAAC,UAAD,CAAa,OAAb,CAAsB,MAAtB,CAA8B,WAA9B,CAA2C,EAA3C,CADZ,EA/BJ,CAmCG,CAACH,KAAK,EAAII,MAAV,gBACC,KAAC,YAAD,EACE,OAAO,CAAEJ,KAAK,EAAII,MADpB,CAEE,QAAQ,CAAC,OAFX,CAGE,OAAO,CAAC,UAHV,EApCJ,CA0CG,CAACL,OAAD,EACD,CAACI,QADA,GAEA,CAAAF,SAAS,OAAT,EAAAA,SAAS,SAAT,QAAAA,SAAS,CAAEsB,MAAX,IAAsB,IAAtB,EAA8B,CAAAtB,SAAS,OAAT,EAAAA,SAAS,SAAT,QAAAA,SAAS,CAAEsB,MAAX,IAAsBC,SAApD,CACG,IADH,CAEG,CAAAvB,SAAS,OAAT,EAAAA,SAAS,SAAT,QAAAA,SAAS,CAAEsB,MAAX,CAAkBE,MAAlB,GAA4B,CAJ/B,eAKC,KAAC,YAAD,EACE,OAAO,CAAC,kBADV,CAEE,QAAQ,CAAC,MAFX,CAGE,OAAO,CAAC,UAHV,EALD,CAWC,CAAC1B,OAAD,EACA,CAACI,QADD,eAEE,KAAC,cAAD,EAAgB,KAAK,CAAE,CAAEmB,SAAS,CAAE,MAAb,CAAvB,uBACE,MAAC,KAAD,EAAO,KAAK,CAAE,CAAE1C,MAAM,CAAE,4BAAV,CAAd,wBACE,KAAC,SAAD,wBACE,MAAC,QAAD,yBACE,KAAC,eAAD,uBADF,cAEE,KAAC,eAAD,oBAFF,cAGE,KAAC,eAAD,mBAHF,cAIE,KAAC,eAAD,EAAiB,KAAK,CAAE,CAAE8C,SAAS,CAAE,QAAb,CAAxB,uBAJF,cAOE,KAAC,eAAD,IAPF,GADF,EADF,cAYE,KAAC,SAAD,WACGzB,SADH,SACGA,SADH,oCACGA,SAAS,CAAEsB,MADd,4CACG,kBAAmBI,GAAnB,CACC,cAAwD,IAArDR,CAAAA,EAAqD,MAArDA,EAAqD,CAAjDS,QAAiD,MAAjDA,QAAiD,CAAvCC,MAAuC,MAAvCA,MAAuC,CAA/BlB,WAA+B,MAA/BA,WAA+B,CAAlBC,WAAkB,MAAlBA,WAAkB,CACtDiB,MAAM,CAAGvF,aAAa,CAACuF,MAAD,CAAtB,CACAjB,WAAW,CAAGD,WAAW,CACrBrE,aAAa,CAACsE,WAAD,CADQ,CAErB,IAFJ,CAGA,mBACE,MAAC,cAAD,yBACE,KAAC,eAAD,WAAkBO,EAAlB,EADF,cAEE,KAAC,eAAD,wBACE,8BAAUS,QAAQ,CAACE,OAAT,CAAiB,CAAjB,CAAV,GADF,EAFF,cAKE,KAAC,eAAD,WAAkBD,MAAlB,EALF,cAME,KAAC,eAAD,EAAiB,KAAK,CAAE,CAAEH,SAAS,CAAE,QAAb,CAAxB,uBACE,KAAC,UAAD,EACE,KAAK,CAAE,CAAC,WAAD,CAAc,eAAd,CADT,CAEE,UAAU,CAAE,CAAC,OAAD,CAAU,KAAV,CAFd,CAGE,KAAK,CAAEf,WAHT,CAIE,IAAI,CAAEQ,EAJR,CAKE,YAAY,CAAEb,iBALhB,EADF,EANF,cAeE,KAAC,eAAD,EAAiB,KAAK,CAAE,CAAEoB,SAAS,CAAE,QAAb,CAAxB,uBACE,KAAC,MAAD,EACE,OAAO,CAAC,WADV,CAEE,KAAK,CAAC,SAFR,CAGE,IAAI,CAAC,QAHP,CAIE,gBAAgB,KAJlB,CAKE,OAAO,CAAE,yBAAMlC,CAAAA,OAAO,CAACuC,IAAR,mBAAwBZ,EAAxB,EAAN,EALX,qBADF,EAfF,GAAqBA,EAArB,CADF,CA6BD,CAnCF,CADH,EAZF,CAmDGlB,SAAS,eACR,KAAC,mBAAD,EACE,OAAO,CAAE,CADX,CAEE,QAAQ,CAAEA,SAFZ,CAGE,gBAAgB,CAAEc,gBAHpB,CAIE,mBAAmB,CAAEK,mBAJvB,EApDJ,GADF,EAvDN,GADF,CA0HD,CAvLD,CAyLA,cAAejC,CAAAA,UAAf","sourcesContent":["import React, { useEffect } from 'react';\nimport { useHistory, useParams } from 'react-router-dom';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport ListSearchBar from '../components/ListSearchBar';\n\nimport { dateFormatter } from '../../../helpers';\n\nimport {\n  getOrderListByUser,\n  updateOrderIsDelivered,\n} from '../../../redux/actionCreators/orderActionCreators';\n\nimport PageHeading from '../../shared/ui/PageHeading';\nimport TablePaginationComp from '../../shared/ui/TablePaginationComp';\nimport AlertMessage from '../../shared/ui/AlertMessage';\nimport SwitchComp from '../../shared/ui/SwitchComp';\nimport SkeletonHistory from '../../shared/ui/skeletons/SkeletonHistory';\n\nimport { makeStyles, withStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport Table from '@material-ui/core/Table';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableRow from '@material-ui/core/TableRow';\nimport TableCell from '@material-ui/core/TableCell';\nimport IconButton from '@material-ui/core/IconButton';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport Zoom from '@material-ui/core/Zoom';\n\nimport RefreshIcon from '@material-ui/icons/RefreshSharp';\n\nconst useStyles = makeStyles((theme) => ({\n  topBtns: {\n    display: 'flex',\n    width: '100%',\n    marginBottom: '10px',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n  },\n}));\n\nconst StyledTableCell = withStyles((theme) => ({\n  head: {\n    backgroundColor: theme.palette.action.white,\n    color: theme.palette.common.black,\n    border: '1px solid rgba(0,0,0,0.08)',\n  },\n  body: {\n    fontSize: theme.spacing(2),\n    border: '1px solid rgba(0,0,0,0.08)',\n  },\n}))(TableCell);\n\nconst StyledTableRow = withStyles((theme) => ({\n  root: {\n    '&:nth-of-type(odd)': {\n      backgroundColor: theme.palette.action.hover,\n    },\n  },\n}))(TableRow);\n\nconst UserOrders = () => {\n  const classes = useStyles();\n  const dispatch = useDispatch();\n  const userIdFromUrl = useParams().uid;\n  const history = useHistory();\n  const fromAdminPage =\n    history.location?.pathname.indexOf('/orders/users/') === -1 ? false : true;\n\n  const { loading, error, orderInfo } = useSelector(\n    (state) => state.orderListByUser\n  );\n  const {\n    loading: loading2,\n    error: error2,\n    loggedInUser,\n  } = useSelector((state) => state.userAuth);\n\n  const changeIsDelivered = (orderId, delivered) => {\n    if (loggedInUser?.token) {\n      const updateInfo = {\n        isDelivered: delivered,\n        deliveredAt: delivered ? new Date().toISOString() : null,\n      };\n      dispatch(\n        updateOrderIsDelivered(orderId, loggedInUser?.token, updateInfo)\n      );\n    }\n  };\n  const handlePageChange = (page, perPage) => {\n    dispatch(\n      getOrderListByUser(\n        fromAdminPage ? userIdFromUrl : loggedInUser?.user.id,\n        loggedInUser?.token,\n        '',\n        page,\n        perPage\n      )\n    );\n  };\n  const handlePerPageChange = (perPage) => {\n    dispatch(\n      getOrderListByUser(\n        fromAdminPage ? userIdFromUrl : loggedInUser?.user.id,\n        loggedInUser?.token,\n        '',\n        '',\n        perPage\n      )\n    );\n  };\n  useEffect(() => {\n    if (loggedInUser) {\n      dispatch(\n        getOrderListByUser(\n          fromAdminPage ? userIdFromUrl : loggedInUser?.user.id,\n          loggedInUser?.token\n        )\n      );\n    }\n  }, [loggedInUser, fromAdminPage, userIdFromUrl, dispatch]);\n\n  return (\n    <>\n      {fromAdminPage && (\n        <PageHeading size=\"medium\" text=\"ALL USER ORDERS\" paragraph />\n      )}\n      <div className={classes.topBtns}>\n        <ListSearchBar\n          item=\"user order\"\n          args={[\n            fromAdminPage ? userIdFromUrl : loggedInUser?.user.id,\n            loggedInUser?.token,\n          ]}\n        />\n        <Tooltip TransitionComponent={Zoom} title=\"Refresh\">\n          <IconButton\n            className={classes.iconBtn}\n            color=\"primary\"\n            onClick={() =>\n              dispatch(\n                getOrderListByUser(\n                  fromAdminPage ? userIdFromUrl : loggedInUser?.user.id,\n                  loggedInUser?.token\n                )\n              )\n            }\n            style={{ marginTop: '20px' }}\n          >\n            <RefreshIcon />\n          </IconButton>\n        </Tooltip>\n      </div>\n      {(loading || loading2) && (\n        <SkeletonHistory\n          headings={['ORDER ID', 'TOTAL', 'PAID', 'DELIVERED', '']}\n        />\n      )}\n      {(error || error2) && (\n        <AlertMessage\n          message={error || error2}\n          severity=\"error\"\n          variant=\"outlined\"\n        />\n      )}\n      {!loading &&\n      !loading2 &&\n      (orderInfo?.orders === null || orderInfo?.orders === undefined\n        ? null\n        : orderInfo?.orders.length <= 0) ? (\n        <AlertMessage\n          message=\"NO ORDER HISTORY\"\n          severity=\"info\"\n          variant=\"outlined\"\n        />\n      ) : (\n        !loading &&\n        !loading2 && (\n          <TableContainer style={{ marginTop: '70px' }}>\n            <Table style={{ border: '1px solid rgba(0,0,0,0.08)' }}>\n              <TableHead>\n                <TableRow>\n                  <StyledTableCell>ORDER ID</StyledTableCell>\n                  <StyledTableCell>Total</StyledTableCell>\n                  <StyledTableCell>Paid</StyledTableCell>\n                  <StyledTableCell style={{ textAlign: 'center' }}>\n                    Delivered\n                  </StyledTableCell>\n                  <StyledTableCell></StyledTableCell>\n                </TableRow>\n              </TableHead>\n              <TableBody>\n                {orderInfo?.orders?.map(\n                  ({ id, subTotal, paidAt, isDelivered, deliveredAt }) => {\n                    paidAt = dateFormatter(paidAt);\n                    deliveredAt = isDelivered\n                      ? dateFormatter(deliveredAt)\n                      : null;\n                    return (\n                      <StyledTableRow key={id}>\n                        <StyledTableCell>{id}</StyledTableCell>\n                        <StyledTableCell>\n                          <strong>${subTotal.toFixed(2)}</strong>\n                        </StyledTableCell>\n                        <StyledTableCell>{paidAt}</StyledTableCell>\n                        <StyledTableCell style={{ textAlign: 'center' }}>\n                          <SwitchComp\n                            label={['Delivered', 'Not delivered']}\n                            labelColor={['green', 'red']}\n                            value={isDelivered}\n                            info={id}\n                            handleChange={changeIsDelivered}\n                          />\n                        </StyledTableCell>\n                        <StyledTableCell style={{ textAlign: 'center' }}>\n                          <Button\n                            variant=\"contained\"\n                            color=\"primary\"\n                            size=\"medium\"\n                            disableElevation\n                            onClick={() => history.push(`/orders/${id}`)}\n                          >\n                            DETAILS\n                          </Button>\n                        </StyledTableCell>\n                      </StyledTableRow>\n                    );\n                  }\n                )}\n              </TableBody>\n              {orderInfo && (\n                <TablePaginationComp\n                  colSpan={6}\n                  itemInfo={orderInfo}\n                  handlePageChange={handlePageChange}\n                  handlePerPageChange={handlePerPageChange}\n                />\n              )}\n            </Table>\n          </TableContainer>\n        )\n      )}\n    </>\n  );\n};\n\nexport default UserOrders;\n"]},"metadata":{},"sourceType":"module"}