{"ast":null,"code":"import _regeneratorRuntime from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef,forwardRef,useImperativeHandle}from'react';import initializeFirebase from'../../../firebase';import{formatFileName}from'../../../helpers';import{makeStyles}from'@material-ui/core/styles';import Button from'@material-ui/core/Button';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{btn:{height:'45px',padding:'10px',backgroundColor:theme.palette.primary.dark,fontSize:'14px',fontWeight:'700',borderRadius:'0',color:'#fff','&:hover':{backgroundColor:theme.palette.primary.main}},previewBox:{margin:'0 auto','&>img':{width:'250px',height:'250px'}}};});var ImageUpload=/*#__PURE__*/forwardRef(function(_ref,ref){var token=_ref.token;var classes=useStyles();var filePickRef=useRef();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),file=_useState2[0],setFile=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),previewUrl=_useState4[0],setPreviewUrl=_useState4[1];var handleChange=function handleChange(event){if(event.target.files&&event.target.files.length===1){setFile(event.target.files[0]);}};var upload=function upload(uploadTask,ref){return new Promise(function(resolve,reject){uploadTask.on('state_changed',function(snapshot){var progress=snapshot.bytesTransferred/snapshot.totalBytes*100;console.log('Upload is '+progress+'% done');},function(error){reject(error);},function(){return ref.getDownloadURL().then(function(url){resolve(url);});});});};var handleUpload=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(productName){var firebase,fileName,_ref3,uploadTask,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!file){_context.next=12;break;}_context.next=3;return initializeFirebase(token);case 3:firebase=_context.sent;setPreviewUrl(null);fileName=formatFileName(productName);_ref3=firebase.storage().ref(\"/products/images/\".concat(fileName,\".jpg\"));uploadTask=_ref3.put(file);_context.next=10;return upload(uploadTask,_ref3);case 10:url=_context.sent;return _context.abrupt(\"return\",url);case 12:case\"end\":return _context.stop();}}},_callee);}));return function handleUpload(_x){return _ref2.apply(this,arguments);};}();useImperativeHandle(ref,function(){return{handleUpload:handleUpload};});useEffect(function(){if(file){var fileReader=new FileReader();fileReader.onload=function(){setPreviewUrl(fileReader.result);};fileReader.readAsDataURL(file);}},[file]);return/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:'none'},ref:filePickRef,accept:\".jpg, .jpeg, .png\",onChange:handleChange}),/*#__PURE__*/_jsx(\"div\",{className:classes.previewBox,children:/*#__PURE__*/_jsx(\"img\",{src:previewUrl||'/images/placeholder.jpg',alt:\"Preview\"})}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",disableElevation:true,className:classes.btn,onClick:function onClick(){return filePickRef.current.click();},children:\"Choose Image\"})]});});export default ImageUpload;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/shared/formElements/ImageUpload.js"],"names":["React","useState","useEffect","useRef","forwardRef","useImperativeHandle","initializeFirebase","formatFileName","makeStyles","Button","useStyles","theme","btn","height","padding","backgroundColor","palette","primary","dark","fontSize","fontWeight","borderRadius","color","main","previewBox","margin","width","ImageUpload","ref","token","classes","filePickRef","file","setFile","previewUrl","setPreviewUrl","handleChange","event","target","files","length","upload","uploadTask","Promise","resolve","reject","on","snapshot","progress","bytesTransferred","totalBytes","console","log","error","getDownloadURL","then","url","handleUpload","productName","firebase","fileName","storage","put","fileReader","FileReader","onload","result","readAsDataURL","textAlign","display","current","click"],"mappings":"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","sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\n\nimport initializeFirebase from '../../../firebase';\nimport { formatFileName } from '../../../helpers';\n\nimport { makeStyles } from '@material-ui/core/styles';\nimport Button from '@material-ui/core/Button';\n\nconst useStyles = makeStyles((theme) => ({\n  btn: {\n    height: '45px',\n    padding: '10px',\n    backgroundColor: theme.palette.primary.dark,\n    fontSize: '14px',\n    fontWeight: '700',\n    borderRadius: '0',\n    color: '#fff',\n    '&:hover': {\n      backgroundColor: theme.palette.primary.main,\n    },\n  },\n  previewBox: {\n    margin: '0 auto',\n    '&>img': {\n      width: '250px',\n      height: '250px',\n    },\n  },\n}));\n\nconst ImageUpload = forwardRef(({ token }, ref) => {\n  const classes = useStyles();\n  const filePickRef = useRef();\n  const [file, setFile] = useState(null);\n  const [previewUrl, setPreviewUrl] = useState(null);\n\n  const handleChange = (event) => {\n    if (event.target.files && event.target.files.length === 1) {\n      setFile(event.target.files[0]);\n    }\n  };\n\n  const upload = (uploadTask, ref) => {\n    return new Promise((resolve, reject) => {\n      uploadTask.on(\n        'state_changed',\n        (snapshot) => {\n          const progress =\n            (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n          console.log('Upload is ' + progress + '% done');\n        },\n        (error) => {\n          reject(error);\n        },\n        () =>\n          ref.getDownloadURL().then((url) => {\n            resolve(url);\n          })\n      );\n    });\n  };\n\n  const handleUpload = async (productName) => {\n    if (file) {\n      const firebase = await initializeFirebase(token);\n      setPreviewUrl(null);\n      const fileName = formatFileName(productName);\n      const ref = firebase.storage().ref(`/products/images/${fileName}.jpg`);\n      const uploadTask = ref.put(file);\n      const url = await upload(uploadTask, ref);\n      return url;\n    }\n  };\n\n  useImperativeHandle(ref, () => ({\n    handleUpload: handleUpload,\n  }));\n\n  useEffect(() => {\n    if (file) {\n      const fileReader = new FileReader();\n      fileReader.onload = () => {\n        setPreviewUrl(fileReader.result);\n      };\n      fileReader.readAsDataURL(file);\n    }\n  }, [file]);\n\n  return (\n    <div style={{ textAlign: 'center' }}>\n      <input\n        type=\"file\"\n        style={{ display: 'none' }}\n        ref={filePickRef}\n        accept=\".jpg, .jpeg, .png\"\n        onChange={handleChange}\n      />\n      <div className={classes.previewBox}>\n        <img src={previewUrl || '/images/placeholder.jpg'} alt=\"Preview\" />\n      </div>\n      <Button\n        variant=\"contained\"\n        disableElevation\n        className={classes.btn}\n        onClick={() => filePickRef.current.click()}\n      >\n        Choose Image\n      </Button>\n    </div>\n  );\n});\n\nexport default ImageUpload;\n"]},"metadata":{},"sourceType":"module"}