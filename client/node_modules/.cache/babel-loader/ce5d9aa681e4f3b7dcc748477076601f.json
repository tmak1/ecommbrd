{"ast":null,"code":"import React,{useEffect}from'react';import{useDispatch,useSelector}from'react-redux';import ReviewForm from'./ReviewForm';import ReviewList from'./ReviewList';import PageHeading from'../../shared/ui/PageHeading';import AlertMessage from'../../shared/ui/AlertMessage';import{getAllProductReviews}from'../../../redux/actionCreators/reviewActionCreators';import{getProductOrderByUser}from'../../../redux/actionCreators/orderActionCreators';import SkeletonReviews from'../../shared/ui/skeletons/SkeletonReviews';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Reviews=function Reviews(_ref){var _loggedInUser$user;var product=_ref.product;var dispatch=useDispatch();var _useSelector=useSelector(function(state){return state.userAuth;}),loggedInUser=_useSelector.loggedInUser;var _useSelector2=useSelector(function(state){return state.productReviews||{};}),loading=_useSelector2.loading,error=_useSelector2.error,reviews=_useSelector2.reviews;var _useSelector3=useSelector(function(state){return state.orderForProductByUser||{};}),loading2=_useSelector3.loading,error2=_useSelector3.error,orderExists=_useSelector3.orderExists;var refreshReviews=function refreshReviews(){dispatch(getAllProductReviews(product.id));};useEffect(function(){dispatch(getAllProductReviews(product.id));},[product===null||product===void 0?void 0:product.id,dispatch]);useEffect(function(){if(loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token){dispatch(getProductOrderByUser(product===null||product===void 0?void 0:product.id,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token));}},[reviews,dispatch,loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token,product.id]);return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{children:[(loading||loading2)&&/*#__PURE__*/_jsx(SkeletonReviews,{userreviews:false}),(error||error2)&&/*#__PURE__*/_jsx(AlertMessage,{message:error||error2,severity:\"error\",variant:\"outlined\"}),!loading&&!loading2&&!error&&!error2?/*#__PURE__*/_jsxs(_Fragment,{children:[((loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.token)&&orderExists||(loggedInUser===null||loggedInUser===void 0?void 0:(_loggedInUser$user=loggedInUser.user)===null||_loggedInUser$user===void 0?void 0:_loggedInUser$user.isAdmin))&&/*#__PURE__*/_jsx(ReviewForm,{loggedInUser:loggedInUser,product:product,review:reviews===null||reviews===void 0?void 0:reviews.find(function(review){return(review===null||review===void 0?void 0:review.userId._id)===(loggedInUser===null||loggedInUser===void 0?void 0:loggedInUser.user.id);}),refreshReviews:refreshReviews}),/*#__PURE__*/_jsx(PageHeading,{size:\"medium\",text:\"Reviews\"}),(reviews===null||reviews===void 0?void 0:reviews.length)>0?/*#__PURE__*/_jsx(ReviewList,{reviews:reviews,loggedInUser:loggedInUser,userreview:false,refreshReviews:refreshReviews}):/*#__PURE__*/_jsx(\"div\",{children:\"No reviews yet\"})]}):null]})});};export default Reviews;","map":{"version":3,"sources":["/Users/tmak/Desktop/tei/udemy/brdtrv/ecomm/client/src/components/products/components/Reviews.js"],"names":["React","useEffect","useDispatch","useSelector","ReviewForm","ReviewList","PageHeading","AlertMessage","getAllProductReviews","getProductOrderByUser","SkeletonReviews","Reviews","product","dispatch","state","userAuth","loggedInUser","productReviews","loading","error","reviews","orderForProductByUser","loading2","error2","orderExists","refreshReviews","id","token","user","isAdmin","find","review","userId","_id","length"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport ReviewForm from './ReviewForm';\nimport ReviewList from './ReviewList';\nimport PageHeading from '../../shared/ui/PageHeading';\nimport AlertMessage from '../../shared/ui/AlertMessage';\n\nimport { getAllProductReviews } from '../../../redux/actionCreators/reviewActionCreators';\nimport { getProductOrderByUser } from '../../../redux/actionCreators/orderActionCreators';\nimport SkeletonReviews from '../../shared/ui/skeletons/SkeletonReviews';\n\nconst Reviews = ({ product }) => {\n  const dispatch = useDispatch();\n  const { loggedInUser } = useSelector((state) => state.userAuth);\n  const { loading, error, reviews } = useSelector(\n    (state) => state.productReviews || {}\n  );\n  const {\n    loading: loading2,\n    error: error2,\n    orderExists,\n  } = useSelector((state) => state.orderForProductByUser || {});\n\n  const refreshReviews = () => {\n    dispatch(getAllProductReviews(product.id));\n  };\n\n  useEffect(() => {\n    dispatch(getAllProductReviews(product.id));\n  }, [product?.id, dispatch]);\n\n  useEffect(() => {\n    if (loggedInUser?.token) {\n      dispatch(getProductOrderByUser(product?.id, loggedInUser?.token));\n    }\n  }, [reviews, dispatch, loggedInUser?.token, product.id]);\n\n  return (\n    <>\n      <div>\n        {(loading || loading2) && <SkeletonReviews userreviews={false} />}\n        {(error || error2) && (\n          <AlertMessage\n            message={error || error2}\n            severity=\"error\"\n            variant=\"outlined\"\n          />\n        )}\n        {!loading && !loading2 && !error && !error2 ? (\n          <>\n            {((loggedInUser?.token && orderExists) ||\n              loggedInUser?.user?.isAdmin) && (\n              <ReviewForm\n                loggedInUser={loggedInUser}\n                product={product}\n                review={reviews?.find(\n                  (review) => review?.userId._id === loggedInUser?.user.id\n                )}\n                refreshReviews={refreshReviews}\n              />\n            )}\n            <PageHeading size=\"medium\" text=\"Reviews\" />\n            {reviews?.length > 0 ? (\n              <ReviewList\n                reviews={reviews}\n                loggedInUser={loggedInUser}\n                userreview={false}\n                refreshReviews={refreshReviews}\n              />\n            ) : (\n              <div>No reviews yet</div>\n            )}\n          </>\n        ) : null}\n      </div>\n    </>\n  );\n};\n\nexport default Reviews;\n"]},"metadata":{},"sourceType":"module"}